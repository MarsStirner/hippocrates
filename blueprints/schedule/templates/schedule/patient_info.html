{% extends 'schedule/base.html' %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
    <legend xmlns="http://www.w3.org/1999/html">Пациент</legend>
    <button class="btn btn-default" onclick="history.back()">Назад к результатам поиска</button>
    <a class="btn btn-success" href="{{ url_for('.appointment') }}?client_id={{ clientData['id'] }}">Записать на приём</a>
    <div ng-controller="ClientInfo">
{#        <form class="form-inline" role="form">#}
{#            <input class="form-control" type="text" ng-model="doctorInput" placeholder="ФИО врача">#}
{#        </form>#}
        <h4>Информация о пациенте <a  ng-click="editing = true" class="btn btn-sm btn-default navbar-btn" href="" title="Редактировать"><span class="glyphicon glyphicon-pencil"></span></a></h4>
        <ul class="nav nav-tabs">
            <li ng-class="{active: tub_selected==1 }"><a href ng-click="tub_selected=1; editing=false">Основная информация</a></li>
            <li ng-class="{active: tub_selected==2 }"><a href ng-click="tub_selected=2; editing=false">Соц. статус</a></li>
            <li ng-class="{active: tub_selected==3 }"><a href ng-click="tub_selected=3; editing=false">Особенности</a></li>
            <li ng-class="{active: tub_selected==4 }"><a href ng-click="tub_selected=4; editing=false">Идентификаторы</a></li>
            <li ng-class="{active: tub_selected==5 }"><a href ng-click="tub_selected=5; editing=false">Связи и контакты</a></li>
            <li ng-class="{active: tub_selected==6 }"><a href ng-click="tub_selected=6; editing=false">История документов</a></li>
        </ul>
        <div class="tub_content" ng-show="tub_selected == 1">
            <table class="table table-condensed" ng-hide="editing">
                <tbody>
                <tr ng-repeat="key in clientMainInfoCodeOrder" ng-if="clientDataItems[key]">
                    <td>[[ clientInfoCode2Name[key] ]]</td>
                    <td>[[ aux.format(clientDataItems, key) ]]</td>
                </tr>
                </tbody>
            </table>


            <form name="client_form_tab1" class="form-horizontal container-fluid" role="form" ng-show="editing">
                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-3" >
                        {{ form.lastname.label(class="control-label") }}
                        <div>
                            {{ form.lastname(class="form-control", autocomplete="off", placeholder="Фамилия", ng_model="clientDataItems['lastName']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-3" style="margin-right: -5px; margin-left: -5px;">
                        {{ form.firstname.label(class="control-label") }}
                        <div>
                            {{ form.firstname(class="form-control", autocomplete="off", placeholder="Имя", ng_model="clientDataItems['firstName']")}}
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        {{ form.patronymic.label(class="control-label") }}
                        <div>
                            {{ form.patronymic(class="form-control", autocomplete="off", placeholder="Отчество", ng_model="clientDataItems['patrName']") }}
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-3" style="margin-right: -5px;">
                        {{ form.birthDate.label(class="control-label") }}
                        <div>
                            {{ form.birthDate(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="clientDataItems['birthDate']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2">
                        {{ form.gender.label(class="control-label") }}
                        <div>
                            {{ form.gender(class="form-control", autocomplete="off", ng_model="clientDataItems['sex']") }}
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-4" >
                        {{ form.snils.label(class="control-label") }}
                        <div id="SNILS">
                            {{ form.snils(class="form-control", autocomplete="off", ng_model="clientDataItems['SNILS']") }}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <h4>Документ</h4>
                </div>
                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-4">
                        {{ form.document_type.label(class="control-label") }}
                        <div>
                            {{ form.document_type(class="form-control", autocomplete="off", ng_model="clientDataItems['document']['typeCode']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" style="margin-right: -5px; margin-left: -5px;">
                        {{ form.document_serial.label(class="control-label") }}
                        <div>
                            {{ form.document_serial(class="form-control", autocomplete="off", placeholder="серия", ng_model="clientDataItems['document']['serial']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" >
                        {{ form.document_number.label(class="control-label") }}
                        <div>
                            {{ form.document_number(class="form-control", autocomplete="off", placeholder="номер", ng_model="clientDataItems['document']['number']") }}
                        </div>
                    </div>
                </div>

                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-2">
                        {{ form.document_begDate.label(class="control-label") }}
                        <div>
                            {{ form.document_begDate(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="clientDataItems['document']['begDate']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" style="margin-right: -5px; margin-left: -5px;">
                        {{ form.document_endDate.label(class="control-label") }}
                        <div>
                            {{ form.document_endDate(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="clientDataItems['document']['endDate']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-4">
                        {{ form.ufms.label(class="control-label") }}
                        <div>
                            {{ form.ufms(class="form-control", autocomplete="off", ng_model="clientDataItems['document']['origin']") }}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <h4>Полис ОМС</h4>
                </div>
                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-4">
                        {{ form.compulsory_policy_type.label(class="control-label") }}
                        <div>
                            {{ form.compulsory_policy_type(class="form-control", autocomplete="off", ng_model="clientDataItems['compulsoryPolicy']['typeCode']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" style="margin-right: -5px; margin-left: -5px;">
                        {{ form.compulsory_policy_serial.label(class="control-label") }}
                        <div>
                            {{ form.compulsory_policy_serial(class="form-control", autocomplete="off", placeholder="серия", ng_model="clientDataItems['compulsoryPolicy']['serial']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" >
                        {{ form.compulsory_policy_number.label(class="control-label") }}
                        <div>
                            {{ form.compulsory_policy_number(class="form-control", autocomplete="off", placeholder="номер", ng_model="clientDataItems['compulsoryPolicy']['number']") }}
                        </div>
                    </div>
                </div>

                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-2" >
                        {{ form.compulsory_policy_begDate.label(class="control-label") }}
                        <div>
                            {{ form.compulsory_policy_begDate(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="clientDataItems['compulsoryPolicy']['begDate']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" style="margin-right: -5px; margin-left: -5px;">
                        {{ form.compulsory_policy_endDate.label(class="control-label") }}
                        <div>
                            {{ form.compulsory_policy_endDate(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="clientDataItems['compulsoryPolicy']['endDate']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-4">
                        {{ form.compulsory_policy_org.label(class="control-label") }}
                        <div>
                            {{ form.compulsory_policy_org(class="form-control", autocomplete="off", ng_model="clientDataItems['compulsoryPolicy']['insurer_id']") }}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <h4>Полис ДМС</h4>
                </div>
                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-4">
                        {{ form.voluntary_policy_type.label(class="control-label") }}
                        <div>
                            {{ form.voluntary_policy_type(class="form-control", autocomplete="off", ng_model="clientDataItems['voluntaryPolicy']['typeCode']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" style="margin-right: -5px; margin-left: -5px;">
                        {{ form.compulsory_policy_serial.label(class="control-label") }}
                        <div>
                            {{ form.voluntary_policy_serial(class="form-control", autocomplete="off", placeholder="серия", ng_model="clientDataItems['voluntaryPolicy']['serial']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" >
                        {{ form.voluntary_policy_number.label(class="control-label") }}
                        <div>
                            {{ form.voluntary_policy_number(class="form-control", autocomplete="off", placeholder="номер", ng_model="clientDataItems['voluntaryPolicy']['number']") }}
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-left: 10px;">
                    <div class="form-group col-md-2">
                        {{ form.voluntary_policy_begDate.label(class="control-label") }}
                        <div>
                            {{ form.voluntary_policy_begDate(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="clientDataItems['voluntaryPolicy']['begDate']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-2" style="margin-right: -5px; margin-left: -5px;">
                        {{ form.voluntary_policy_endDate.label(class="control-label") }}
                        <div>
                            {{ form.voluntary_policy_endDate(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="clientDataItems['voluntaryPolicy']['endDate']") }}
                        </div>
                    </div>
                    <div class="form-group col-md-4">
                        {{ form.voluntary_policy_org.label(class="control-label") }}
                        <div>
                            {{ form.voluntary_policy_org(class="form-control", autocomplete="off", ng_model="clientDataItems['voluntaryPolicy']['insurer_id']") }}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-md-4" >
                        {{ form.notes.label(class="control-label") }}
                        <div>
                            {{ form.notes(class="form-control", autocomplete="off", ng_model="clientDataItems['notes']") }}
                        </div>
                    </div>
                </div>
            </form>
            <div class="col-sm-offset-2 col-md-10" ng-show="editing">
                <button ng-click="save_client_info()" class="btn btn-success">Сохранить</button>
            </div>

        </div>
        <div class="tub_content" ng-show="tub_selected == 2">
            <table class="table table-condensed" ng-if="clientDataItems['socStatuses']" ng-hide="editing">
                <thead>
                     <tr>
                        <th>Класс</th>
                        <th>Тип</th>
                        <th>Дата начала</th>
                        <th>Дата окончания</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="status in clientDataItems['socStatuses']">
                        <td>[[status.className]]</td>
                        <td>[[status.typeName]]</td>
                        <td>[[status.begDate]]</td>
                        <td>[[status.endDate]]</td>
                    </tr>
                </tbody>
            </table>
            <form name="client_form_tab2" class="form-horizontal" role="form" ng-show="editing">
                <table class="table table-condensed" ng-if="clientDataItems['socStatuses']">
                    <thead>
                         <tr>
                            <th>Класс</th>
                            <th>Тип</th>
                            <th>Дата начала</th>
                            <th>Дата окончания</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="status in clientDataItems['socStatuses']">
                            <td class="col-md-4">{{ form.soc_status_class(class="form-control", autocomplete="off", ng_model="status.classCode") }}</td>
                            <td class="col-md-4">{{ form.soc_status_type(class="form-control", autocomplete="off", ng_model="status.typeCode") }}</td>
                            <td class="col-md-2">{{ form.soc_status_begDate(class="form-control", autocomplete="off", datepicker_popup="dd.MM.yyyy", ng_model="status.begDate") }}</td>
                            <td class="col-md-2">{{ form.soc_status_endDate(class="form-control", autocomplete="off", datepicker_popup="dd.MM.yyyy", ng_model="status.endDate") }}</td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <div class="col-sm-offset-2 col-md-10" ng-show="editing">
                <button ng-click="save_client_info()" class="btn btn-success">Сохранить</button>
            </div>
        </div>
        <div class="tub_content" ng-show="tub_selected == 3">
            <table class="table table-condensed" ng-if="clientDataItems['bloodHistory']" ng-hide="editing">
                <caption>Группа крови и резус-фактор</caption>
                <thead>
                     <tr>
                         <th>Группа крови</th>
                         <th>Дата установления</th>
                         <th>Врач</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="blood in clientDataItems['bloodHistory']">
                        <td>[[blood.bloodGroup]]</td>
                        <td>[[blood.bloodDate]]</td>
                        <td>[[blood.physician]]</td>
                    </tr>
                </tbody>
            </table>

            <form class="form-horizontal" role="form" ng-show="editing">
                <table class="table table-condensed">
                <caption>Группа крови и резус-фактор</caption>
                    <thead>
                         <tr>
                             <th>Группа крови</th>
                             <th>Дата установления</th>
                             <th>Врач</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="blood in clientDataItems['bloodHistory']">
                            <td class="col-md-4">{{ form.blood_group(class="form-control", autocomplete="off", ng_model="blood.bloodGroup") }}</td>
                            <td class="col-md-3">{{ form.blood_date(class="form-control", datepicker_popup="dd.MM.yyyy", autocomplete="off", ng_model="blood.bloodDate") }}</td>
                            <td class="col-md-5"></td>
                        </tr>
                    </tbody>
                </table>
            </form>

            <table class="table table-condensed" ng-if="clientDataItems['allergies']" ng-hide="editing">
                <caption>Аллергия</caption>
                <thead>
                     <tr>
                        <th>Наименование вещества</th>
                        <th>Степень</th>
                        <th>Дата установления</th>
                        <th>Примечание</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="allergy in clientDataItems['allergies']">
                        <td>[[allergy.nameSubstance]]</td>
                        <td>[[allergy.power]]</td>
                        <td>[[allergy.createDate]]</td>
                        <td>[[allergy.notes]]</td>
                    </tr>
                </tbody>
            </table>

            <form class="form-horizontal" role="form" ng-show="editing">
                <table class="table table-condensed">
                    <caption>Аллергия</caption>
                    <thead>
                         <tr>
                            <th>Наименование вещества</th>
                            <th>Степень</th>
                            <th>Дата установления</th>
                            <th>Примечание</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="allergy in clientDataItems['allergies']">
                            <td class="col-md-4">{{ form.allergy_substance(class="form-control", autocomplete="off", ng_model="allergy.nameSubstance") }}</td>
                            <td class="col-md-3">{{ form.allergy_power(class="form-control", autocomplete="off", ng_model="allergy.power") }}</td>
                            <td class="col-md-2">{{ form.allergy_createDate(class="form-control", autocomplete="off", datepicker_popup="dd.MM.yyyy", ng_model="allergy.createDate") }}</td>
                            <td class="col-md-3">{{ form.allergy_notes(class="form-control", autocomplete="off", ng_model="allergy.notes") }}</td>
                        </tr>
                    </tbody>
                </table>
            </form>

            <table class="table table-condensed" ng-if="clientDataItems['intolerances']" ng-hide="editing">
                <caption>Медикаметозная непереносимость</caption>
                <thead>
                     <tr>
                        <th>Наименование медикамента</th>
                        <th>Степень</th>
                        <th>Дата установления</th>
                        <th>Примечание</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="intolerance in clientDataItems['intolerances']">
                        <td>[[intolerance.nameMedicament]]</td>
                        <td>[[intolerance.power]]</td>
                        <td>[[intolerance.createDate]]</td>
                        <td>[[intolerance.notes]]</td>
                    </tr>
                </tbody>
            </table>
            <form class="form-horizontal" role="form" ng-show="editing">
                <table class="table table-condensed">
                    <caption>Медикаметозная непереносимость</caption>
                    <thead>
                         <tr>
                            <th>Наименование медикамента</th>
                            <th>Степень</th>
                            <th>Дата установления</th>
                            <th>Примечание</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="intolerance in clientDataItems['intolerances']">
                            <td class="col-md-4">{{ form.intolerance_medicament(class="form-control", autocomplete="off", ng_model="intolerance.nameMedicament") }}</td>
                            <td class="col-md-3">{{ form.intolerance_power(class="form-control", autocomplete="off", ng_model="intolerance.power") }}</td>
                            <td class="col-md-2">{{ form.intolerance_createDate(class="form-control", autocomplete="off", datepicker_popup="dd.MM.yyyy", ng_model="intolerance.createDate") }}</td></td>
                            <td class="col-md-3">{{ form.intolerance_notes(class="form-control", autocomplete="off", ng_model="intolerance.notes") }}</td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <div class="col-sm-offset-2 col-md-10" ng-show="editing">
                <button ng-click="save_client_info()" class="btn btn-success">Сохранить</button>
            </div>
        </div>
        <div class="tub_content" ng-show="tub_selected == 4">
            <table class="table table-condensed" ng-hide="editing">
                <thead>
                     <tr>
                        <th>Внешняя учетная система</th>
                        <th>Идентификатор</th>
                        <th>Дата подтверждения</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="identification in  clientDataItems['identifications']">
                        <td>[[identification.accountingSystem_name]]</td>
                        <td>[[identification.identifier]]</td>
                        <td>[[identification.checkDate]]</td>
                    </tr>
                </tbody>
            </table>
            <form class="form-horizontal" role="form">
                <table class="table table-condensed" ng-show="editing">
                    <thead>
                         <tr>
                            <th>Внешняя учетная система</th>
                            <th>Идентификатор</th>
                            <th>Дата подтверждения</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="identification in  clientDataItems['identifications']">
                             <td class="col-md-4">{{ form.identification_accountingSystem(class="form-control", autocomplete="off", ng_model="identification.accountingSystem_code") }}</td>
                             <td class="col-md-3">{{ form.identification_identifier(class="form-control", autocomplete="off", ng_model="identification.identifier") }}</td>
                             <td class="col-md-2">{{ form.identification_checkDate(class="form-control", autocomplete="off", datepicker_popup="dd.MM.yyyy", ng_model="identification.checkDate") }}</td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <div class="col-sm-offset-2 col-md-10" ng-show="editing">
                <button ng-click="save_client_info()" class="btn btn-success">Сохранить</button>
            </div>
        </div>
        <div class="tub_content" ng-show="tub_selected == 5">
            <table class="table table-condensed" ng-if="clientDataItems['direct_relations']" ng-hide="editing">
                <thead>
                     <tr>
                        <th>Прямая связь</th>
                        <th>Связан с пациентом</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="relation in  clientDataItems['direct_relations']">
                        <td>[[relation.relativeType_name]]</td>
                        <td>[[relation.other_text]]</td>
                    </tr>
                </tbody>
            </table>
            <form class="form-horizontal" role="form">
                <table class="table table-condensed" ng-show="editing">
                    <thead>
                         <tr>
                             <th>Прямая связь</th>
                             <th>Связан с пациентом</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="relation in  clientDataItems['direct_relations']">
                             <td class="col-md-4">{{ form.direct_relation_relation(class="form-control", autocomplete="off", ng_model="relation.relativeType_code") }}</td>
                             <td class="col-md-3">{{ form.direct_relation_other(class="form-control", autocomplete="off", ng_model="relation.other_id") }}</td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <table class="table table-condensed" ng-if="clientDataItems['reversed_relations']" ng-hide="editing">
                <thead>
                     <tr>
                        <th>Обратная связь</th>
                        <th>Связан с пациентом</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="relation in  clientDataItems['reversed_relations']">
                        <td>[[relation.relativeType_name]]</td>
                        <td>[[relation.other_text]]</td>
                    </tr>
                </tbody>
            </table>
            <form class="form-horizontal" role="form">
                <table class="table table-condensed" ng-show="editing">
                    <thead>
                         <tr>
                             <th>Обратная связь</th>
                             <th>Связан с пациентом</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="relation in  clientDataItems['reversed_relations']">
                             <td class="col-md-4">{{ form.reversed_relation_relation(class="form-control", autocomplete="off", ng_model="relation.relativeType_code") }}</td>
                             <td class="col-md-3">{{ form.reversed_relation_other(class="form-control", autocomplete="off", ng_model="relation.other_id") }}</td>
                        </tr>
                    </tbody>
                </table>
            </form>
           <table class="table table-condensed" ng-if="clientDataItems['contacts']" ng-hide="editing">
                <caption>Контакты</caption>
                <thead>
                     <tr>
                         <th>Тип</th>
                         <th>Номер</th>
                         <th>Примечение</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="contact in  clientDataItems['contacts']">
                          <td>[[contact.contactType_name]]</td>
                          <td>[[contact.contact]]</td>
                          <td>[[contact.notes]]</td>
                    </tr>
                </tbody>
           </table>
           <form class="form-horizontal" role="form">
                <table class="table table-condensed" ng-show="editing">
                    <thead>
                         <tr>
                             <th>Тип</th>
                             <th>Номер</th>
                             <th>Примечение</th>
                         </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="contact in  clientDataItems['contacts']">
                             <td class="col-md-4">{{ form.contact_contactType(class="form-control", autocomplete="off", ng_model="contact.contactType_code") }}</td>
                             <td class="col-md-3">{{ form.contact_contact(class="form-control", autocomplete="off", ng_model="contact.contact") }}</td>
                             <td class="col-md-2">{{ form.contact_notes(class="form-control", autocomplete="off", ng_model="contact.notes") }}</td>
                        </tr>
                    </tbody>
                </table>
           </form>
           <div class="col-sm-offset-2 col-md-10" ng-show="editing">
                <button ng-click="save_client_info()" class="btn btn-success">Сохранить</button>
           </div>
        </div>
        <div class="tub_content" ng-show="tub_selected == 6">
            <table class="table table-condensed">
                <thead>
                     <tr>
                        <th>Тип</th>
                        <th>Серия</th>
                        <th>Номер</th>
                        <th>Дата начала</th>
                        <th>Дата окончания</th>
                     </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="document in  clientDataItems['documentHistory']">
                        <td>[[document.typeName]]</td>
                        <td>[[document.serial]]</td>
                        <td>[[document.number]]</td>
                        <td>[[document.begDate]]</td>
                        <td>[[document.endDate]]</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <table class="table">
            <caption>Предварительные записи</caption>
            <thead>
            <tr>
                <th ng-repeat="key in recordColumnOrder" ng-bind="recordColumns[key]"></th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="record in records">
                <td ng-repeat="key in recordColumnOrder" ng-bind="aux.format(record, key)"></td>
            </tr>
            </tbody>
        </table>
{#        <pre>[[schedule|json]]</pre>#}
    </div>
{% endblock %}
{% block modules_js %}
    {{ super() }}
    <script type="text/javascript">
        WebMis20.controller('ClientInfo', ['$scope', '$http', function ($scope, $http) {
            $scope.max_tickets = 0;
            $scope.records = [];
            $scope.aux = aux;
            $scope.params = aux.getQueryParams(document.location.search);
            $scope.client_id = $scope.params.client_id;
            $scope.tub_selected = 1;
            $scope.view = true;
            var curDate = new Date();
            var curYear = curDate.getUTCFullYear();
            $scope.years = [curYear - 1, curYear, curYear + 1];
            $scope.year = curYear;
            $scope.clientInfoCode2Name = {
                'id': 'Код пациента',
                'birthDate': 'Дата рождения',
                'regAddress': 'Адрес регистрации',
                'liveAddress': 'Адрес проживания',
                'SNILS': 'СНИЛС',
                'nameText': 'ФИО',
                'sex': 'Пол',
                'documentText': 'Документ',
                'contact': 'Контакты',
                'voluntaryPolicyText': 'Полис ДМС',
                'compulsoryPolicyText': 'Полис ОМС',
                'notes': 'Примечания'
            };
            $scope.clientMainInfoCodeOrder = ['id', 'nameText', 'birthDate', 'sex', 'regAddress', 'liveAddress',
                'documentText', 'compulsoryPolicyText', 'voluntaryPolicyText', 'SNILS', 'contact', 'notes'];
            $scope.recordColumns = {
                'mark': 'Отметка',
                'begDateTime': 'Дата и время приёма',
                'office': 'Кабинет',
                'person': 'Специалист',
                'createPerson': 'Записал',
                'note': 'Примечания'
            };
            $scope.recordColumnOrder = ['mark', 'begDateTime', 'office', 'person', 'createPerson', 'note'];
            $scope.save_client_info = function() {
                $scope.editing = false;
                $http.get(
                    '{{ url_for('.api_save_patient_info') }}', {
                        params: {
                            client_info: $scope.clientDataItems
                        }
                    });
            };
            $scope.open = function($event) {
                $event.preventDefault();
                $event.stopPropagation();
                return true;
            };
            $http.get(
                '{{ url_for('.api_patient') }}', {
                    params: {
                        'client_id': $scope.client_id
                    }
                }
            ).success(function (data) {
                $scope.clientDataItems = data.result.clientData;
                $scope.referenceBooksItems = data.result.referenceBooks;
                $scope.records = data.result.records;
            });

        }]);
    </script>
{% endblock %}
