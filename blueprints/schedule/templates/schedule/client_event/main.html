{% import "_macros.html" as macros %}
<div class="row">
    <div class="col-md-6">
        <p>Организация: [[ event_info.organisation.short_name ]]</p>
        <p>Лечащий врач: [[ event_info.exec_person.name ]]</p>
        <p>Договор: [[ event_info.contract.number ]]</p>
        <p>Дата начала: [[ event_info.setDate | asDate]]</p>
    </div>
    <div class="col-md-6">
        <p>Тип обращения: [[ event_info.event_type.request_type.name ]]</p>
        <p>Источник финансирования: [[ event_info.finance.name ]]</p>
        <p>Тип события: [[ event_info.event_type.name ]]</p>
        <p>Дата выполнения: [[ event_info.execDate | asDate ]]</p>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">Порядок обращения</div>
            <div class="list-group">
                <div class="list-group-item">
                    <div class="row">
                        <div class="col-sm-4"><label for="event_info.order">Порядок</label></div>
                        <div class="col-sm-8">
                            {{ macros.ui_select('event_info.order', 'rbOrder', 'edit') }}
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row">
                        <div class="col-sm-4"><label for="event_info.is_primary">Первичность</label></div>
                        <div class="col-sm-8">
                            {{ macros.ui_select('event_info.is_primary', 'rbPrimary', 'edit') }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">Результат обращения</div>
            <div class="list-group">
                <div class="list-group-item">
                    <div class="row">
                        <div class="col-sm-4"><label for="event_info.result">Результат</label></div>
                        <div class="col-sm-8">
                            {{ macros.ui_select('event_info.result', 'rbResult', trigger='edit') }}
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row">
                        <div class="col-sm-4"><label for="event_info.acheResult">Исход</label></div>
                        <div class="col-sm-8">
                            {{ macros.ui_select('event_info.acheResult', 'rbAcheResult', 'edit') }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row" ng-hide="diag_edit[0]._first">
    <div class="col-md-12 marginal"><button class="btn btn-primary" ng-click="diag_edit_new()">Новый диагноз</button></div>
</div>
<div class="row" ng-repeat="diagnose in diagnoses">
    <div class="col-md-12">
        <div class="panel panel-info">
            <div class="panel-heading">
                <a ng-if="!diag_edit[$index]" ng-click="diag_edit_start($index)" class="btn btn-default glyphicon glyphicon-edit"></a>
                <a ng-if="diag_edit[$index]" ng-click="diag_edit_save($index)" class="btn btn-success glyphicon glyphicon-ok" ng-disabled="diag_edit_save_disabled($index)"></a>
                <a ng-if="diag_edit[$index]" ng-click="diag_edit_stop($index)" class="btn btn-danger glyphicon glyphicon-remove"></a>
                Диагноз ([[ diagnose.diagnosis_type.name ]])
            </div>
            <div class="panel-body">
                <form class="form form-inline">
                    <fieldset class="row">
                        <div class="form-group col-md-4">
                            <label>Тип диагноза</label>
                            {{ macros.ui_select_tmp('diagnose', 'diagnosis_type', 'rbDiagnosisType', 'diag_edit[$index]') }}
                        </div>
                        <div class="form-group col-md-4">
                            <label>Врач</label>
                            {{ macros.ui_select_tmp('diagnose', 'person', 'Person', 'diag_edit[$index]') }}
                        </div>
                        <div class="form-group col-md-2">
                            <label>МКБ</label>
                            {{ macros.ui_select_tmp_noa('diagnose', 'mkb', 'rbMKB', 'diag_edit[$index]') }}
                        </div>
                        <div class="form-group col-md-2">
                            <label>доп. МКБ</label>
                            {{ macros.ui_select_tmp_noa('diagnose', 'mkb_ex', 'rbMKB', 'diag_edit[$index]') }}
                        </div>
                    </fieldset>
                    <fieldset class="row">
                        <div class="form-group col-md-4">
                            <label>Характер</label>
                            {{ macros.ui_select_tmp('diagnose', 'character', 'rbDiseaseCharacter', 'diag_edit[$index]') }}
                        </div>
                        <div class="form-group col-md-4">
                            <label>Фаза</label>
                            {{ macros.ui_select_tmp('diagnose', 'phase', 'rbDiseasePhases', 'diag_edit[$index]') }}
                        </div>
                        <div class="form-group col-md-4">
                            <label>Стадия</label>
                            {{ macros.ui_select_tmp('diagnose', 'stage', 'rbDiseaseStage', 'diag_edit[$index]') }}
                        </div>
                    </fieldset>
                    <fieldset class="row">
                        <div class="form-group col-md-4">
                            <label>Диспансерное наблюдение</label>
                            {{ macros.ui_select_tmp('diagnose', 'dispanser', 'rbDispanser', 'diag_edit[$index]') }}
                        </div>
                        <div class="form-group col-md-4">
                            <label>Травма</label>
                            {{ macros.ui_select_tmp('diagnose', 'trauma_type', 'rbTraumaType', 'diag_edit[$index]') }}
                        </div>
                        <div class="form-group col-md-4">
                            <label>Группа здоровья</label>
                            {{ macros.ui_select_tmp('diagnose', 'health_group', 'rbHealthGroup', 'diag_edit[$index]') }}
                        </div>
                    </fieldset>
                    <fieldset class="row">
                        <div class="form-group col-md-12">
                            <label class="control-label" for="notes">Примечания</label>
                            <div class="form-control-static" ng-hide="diag_edit[$index]">[[ diagnose.notes ]]</div>
                            <textarea id="notes" class="form-control" ng-model="diag_edit[$index].notes" ng-show="diag_edit[$index]"></textarea>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="dropdown col-md-offset-10 col-md-2">
        <button class="btn dropdown-toggle" type="button" id="print_dropdownMenu" data-toggle="dropdown">
            <span class="glyphicon glyphicon-print"></span>
            Печать
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="print_dropdownMenu">
            <li role="presentation"
                ng-repeat="template in PrintTemplates"><a role="menuitem" tabindex="-1" href="" class="print_template" ng-click="print_template(template.id)">[[ template.name ]]</a></li>
        </ul>
    </div>
</div>