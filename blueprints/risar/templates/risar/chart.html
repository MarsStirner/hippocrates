{% extends 'risar/base.html' %}
{% import 'risar/_macros.html' as rimacros %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
    <div ng-controller="ChartCtrl" ng-cloak>
        <div alert-notify></div>
        <ul class="breadcrumb">
            <li><a href="{{ url_for('.index_html') }}">Рабочий стол</a></li>
            <li>Карта пациентки</li>
        </ul>
        <div class="row small-marginal">
            <div class="col-lg-8 col-md-8">
                <h2>
                    Карта пациентки
                    <a ng-href="{{ url_for('patients.patient') }}?client_id=[[ chart.client.id ]]">[[ chart.client.full_name ]]</a>
                    ([[ chart.external_id ]])
                </h2>
            </div>
            <div class="col-md-2 achievements">
                <b>[[ pregnancy_week ]]</b>
                <i class="fa fa-exclamation-triangle text-danger"></i>
                <i class="fa fa-exclamation-triangle text-success"></i>
                <i class="fa fa-exclamation-triangle text-warning"></i>
                <i class="fa fa-exclamation-triangle"></i>
            </div>
            <div class="col-md-2">
                <button class="btn btn-default btn-block">146%</button>
            </div>
            <div class="col-md-12 col-lg-12">
                <div class="alert-warning small-marginal">Случай беременности. На учёте в <b>[[ chart.person.organisation.short_name ]]</b>
                    у <b>[[ chart.person.name ]]</b>
                    с <b>[[ chart.set_date | asDate ]]</b>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading">Личные данные</div>
                    <table class="table table-condensed table-personal-data">
                        <tbody>
                        <tr>
                            <td>Дата рождения:</td>
                            <td>[[ chart.client.birth_date | asDate ]] ([[ chart.client.age ]])</td>
                        </tr>
                        <tr ng-if="chart.client.snils">
                            <td>СНИЛС:</td>
                            <td>[[ chart.client.snils ]]</td>
                        </tr>
                        <tr ng-if="chart.client.cmi_policy">
                            <td>Полис ОМС:</td>
                            <td>Номер [[ chart.client.cmi_policy.serial ]] [[ chart.client.cmi_policy.number ]], выдан [[ chart.client.cmi_policy.insurer.short_name ]] [[ chart.client.cmi_policy.beg_date | asDate ]]</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">Анамнез / <a ng-href="{{ url_for('.html_anamnesis') }}?event_id=[[ chart.id ]]">подробнее</a></div>
                    <table class="table table-condensed">
                        <tbody>
                        <tr>
                            <td><a ng-href="{{ url_for('.html_anamnesis_mother_edit') }}?event_id=[[ chart.id ]]">Ввести сведения о матери</a></td>
                        </tr>
                        <tr>
                            <td><a ng-href="{{ url_for('.html_anamnesis_father_edit') }}?event_id=[[ chart.id ]]">Ввести сведения об отце</a></td>
                        </tr>
                        <tr>
                            <td><a ng-href="{{ url_for('.html_anamnesis') }}?event_id=[[ chart.id ]]#pregnancies">Ввести сведения о прошлых беременностях</a></td>
                        </tr>
                        <tr>
                            <td><a ng-href="{{ url_for('.html_anamnesis') }}?event_id=[[ chart.id ]]#transfusions">Ввести сведения о переливаниях крови</a></td>
                        </tr>
                        <tr>
                            <td><a ng-href="{{ url_for('.html_anamnesis') }}?event_id=[[ chart.id ]]#intolerances">Ввести сведения об аллергии</a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Осмотры акушером-гинекологом / <a ng-href="{{ url_for('.html_inspection') }}?event_id=[[ chart.id ]]">подробнее</a>
                    <a ng-href="{{ url_for('.html_inspection_edit') }}?event_id=[[ chart.id ]]" class="btn btn-xs btn-success" title="Добавить новый осмотр"><i class="glyphicon glyphicon-plus"></i></a></div>
                    <table class="table table-condensed">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Дата</th>
                            <th>Диагноз</th>
                            <th>Врач</th>
                        </tr>
                        </thead>
                        <tr ng-repeat="checkup in chart.checkups">
                            <td>[[ $index + 1 ]]</td>
                            <td>[[ checkup.beg_date | asDate ]]</td>
                            <td><span class="bottom_dotted" tooltip="[[ checkup.diag.name ]]">[[ checkup.diag.code ]]</span></td>
                            <td>[[ checkup.person.name ]]</td>
                        </tr>
                    </table>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Эпикриз / <a ng-href="#">подробнее</a></div>
                    <div class="panel-body">
                        <span ng-if="!chart.epicrisis">Отсутствует</span>
                        <span ng-if="chart.epicrisis">[[ chart.epicrisis ]]</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">Особенности</div>
                    <table class="table table.condensed">
                        <tbody>
                        <tr ng-repeat="char in chart.anamnesis.intolerances" ng-class="{
                        'success text-success': char.power.code == 'low',
                        'warning text-warning': ['medium', 'unknown'].has(char.power.code),
                        'danger text-danger': ['high', 'strict'].has(char.power.code),
                        }">
                            <td class="text-center "><span class="fa" ng-class="{
                        'fa-question': char.power.code == 'unknown',
                        'fa-exclamation': char.power.code == 'low',
                        'fa-exclamation-triangle': char.power.code == 'medium',
                        'fa-exclamation-circle': char.power.code == 'high',
                        'fa-times-circle': char.power.code == 'strict',
                        }"></span></td>
                            <td>[[ char.type.name ]]</td>
                            <td><b ng-class="{'bottom_dotted': char.note}" tooltip="[[ char.note ]]">[[ char.name ]]</b></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">ЛПУ родоразрешение</div>
                    <table class="table table-condensed">
                        <tbody>
                        <tr>
                            <td>Экстренное</td>
                            <td>ПОДКБ "им. Филатова"</td>
                        </tr>
                        <tr>
                            <td>Плановое</td>
                            <td>Пензенский городской родильный дом № 1</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Прогресс</div>
                    <table class="table table-condensed">
                        <tbody>
                        <tr>
                            <td class="col-md-6">Лабораторные исследования:</td>
                            <td class="col-md-6">
                                <progressbar class="progress" value="chart.progress.lab.percent">
                                    [[ chart.progress.lab.complete ]]/[[ chart.progress.lab.total ]]
                                </progressbar>
                            </td>
                        </tr>
                        <tr>
                            <td>Функциональные исследования:</td>
                            <td>
                                <progressbar class="progress" value="chart.progress.func.percent">
                                    [[ chart.progress.func.complete ]]/[[ chart.progress.func.total ]]
                                </progressbar>
                            </td>
                        </tr>
                        <tr>
                            <td>Осмотры специалистами:</td>
                            <td>
                                <progressbar class="progress" value="chart.progress.checkups.percent">
                                    [[ chart.progress.checkups.complete ]]/[[ chart.progress.checkups.total ]]
                                </progressbar>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script src="{{ url_for('.static', filename='js/chart.js', v=version) }}"></script>
    <script src="{{ url_for('.static', filename='js/risar.js', v=version) }}"></script>
{% endblock %}