<div class="marginal">
<ng-form name="_characteristics" toc-element="Особенности пациента">
    <legend>Особенности пациента</legend>
    <ng-form name="_bloodtype" toc-element="Группа крови">
        <h4>Группа крови и резус фактор</h4>
        <div ng-repeat="bt in client.blood_types.slice(0, 1) | filter: flt_not_deleted()">
            <div class="row">
                <div class="col-md-11">
                    <ng-form name="cbtForm">
                        <wm-client-blood-type id-postfix="$index"
                            model-type="bt.blood_type"
                            model-date="bt.date"
                            model-person="bt.person"
                            edit-mode="bt.id ? false : true"
                            model-blood-type="bt">
                        </wm-client-blood-type>
                    </ng-form>
                </div>
                <div class="col-md-1">
                    <div class="row">
                        <button type="button" class="btn btn-danger marginal" title="Удалить"
                                ng-click="client.delete_record('blood_types', bt)" ng-if="!bt.id">
                            <span class="glyphicon glyphicon-trash"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <button type="button" class="btn btn-primary" ng-if="!client.blood_types.length"
                    ng-click="add_new_blood_type({{ current_user.get_id() }})">Добавить новую</button>
        </div>

        <div ng-if="bt_history_visible()">
            <table class="table table-condensed">
                <caption><h4>История изменений группы крови</h4></caption>
                <thead>
                    <tr>
                        <th>Дата установления</th>
                        <th>Группа крови</th>
                        <th>Установивший</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="bt in client.blood_types">
                        <td>[[bt.date]]</td>
                        <td>[[bt.blood_type.name]]</td>
                        <td>[[bt.person.name]]</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </ng-form>

    <hr>

    <ng-form name="_allergies" toc-element="Аллергия">
        <h4>Аллергия</h4>
        <div ng-repeat="alg in client.allergies | filter: flt_not_deleted()">
            <div class="row">
                <div class="col-md-11">
                    <ng-form name="allergyForm">
                        <wm-client-allergy id-postfix="[[$index]]"
                            type="allergy"
                            model-name="alg.name"
                            model-power="alg.power"
                            model-date="alg.date"
                            model-note="alg.notes"
                            edit-mode="alg.id ? edit.activated : true"
                            model-allergy="alg">
                        </wm-client-allergy>
                    </ng-form>
                </div>
                <div class="col-md-1">
                    <div class="row" ng-show="alg.id">
                        <button type="button" class="btn btn-primary marginal" title="Редактировать"
                                ng-click="edit.activated=true"><span class="glyphicon glyphicon-pencil"></span></button>
                    </div>
                    <div class="row">
                        <button type="button" class="btn btn-danger marginal" title="Удалить"
                                ng-click="client.delete_record('allergies', alg)"><span class="glyphicon glyphicon-trash"></span></button>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <button type="button" class="btn btn-primary"
                    ng-click="client.add_allergy()">Добавить новую</button>
        </div>
    </ng-form>

    <hr>

    <ng-form name="_intolerances" toc-element="Непереносимость">
        <h4>Медикаментозная непереносимость</h4>
        <div ng-repeat="intlr in client.intolerances | filter: flt_not_deleted()">
            <div class="row">
                <div class="col-md-11">
                    <ng-form name="intoleranceForm">
                        <wm-client-allergy id-postfix="[[$index]]"
                            type="intolerance"
                            model-name="intlr.name"
                            model-power="intlr.power"
                            model-date="intlr.date"
                            model-note="intlr.notes"
                            edit-mode="intlr.id ? edit.activated : true"
                            model-allergy="intlr">
                        </wm-client-allergy>
                    </ng-form>
                </div>
                <div class="col-md-1">
                    <div class="row" ng-show="intlr.id">
                        <button type="button" class="btn btn-primary marginal" title="Редактировать"
                                ng-click="edit.activated=true"><span class="glyphicon glyphicon-pencil"></span></button>
                    </div>
                    <div class="row">
                        <button type="button" class="btn btn-danger marginal" title="Удалить"
                                ng-click="client.delete_record('intolerances', intlr)"><span class="glyphicon glyphicon-trash"></span></button>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <button type="button" class="btn btn-primary"
                    ng-click="client.add_med_intolerance()">Добавить новую</button>
        </div>
    </ng-form>

</ng-form>
</div>