<dl class="dl-horizontal" ng-hide="editing_is_active()">
    <dt ng-if="client.client_info.id">Код пациента</dt>
    <dd>[[ client.client_info.id ]]</dd>
    <dt ng-if="client.client_info.nameText">ФИО</dt>
    <dd>[[ client.client_info.nameText ]]</dd>
    <dt ng-if="client.client_info.birthDate">Дата рождения</dt>
    <dd>[[ client.client_info.birthDate | asDate ]]</dd>
    <dt ng-if="client.client_info.sex">Пол</dt>
    <dd>[[ client.client_info.sex.name ]]</dd>
    <dt ng-if="client.client_info.regAddress">Адрес регистрации</dt>
    <dd>[[ client.client_info.regAddress ]]</dd>
    <dt ng-if="client.client_info.liveAddress">Адрес проживания</dt>
    <dd>[[ client.client_info.liveAddress ]]</dd>
    <dt ng-if="client.client_info.documentText">Документ</dt>
    <dd>[[ client.client_info.documentText ]]</dd>
    <dt ng-if="client.client_info.compulsoryPolicy.policyText">Полис ОМС</dt>
    <dd>[[ client.client_info.compulsoryPolicy.policyText ]]</dd>
    <dt ng-if="client.client_info.voluntaryPolicy.policyText">Полис ДМС</dt>
    <dd>[[ client.client_info.voluntaryPolicy.policyText ]]</dd>
    <dt ng-if="client.client_info.SNILS">СНИЛС</dt>
    <dd>[[ client.client_info.SNILS ]]</dd>
    <dt ng-if="client.client_info.contact">Контакты</dt>
    <dd>[[ client.client_info.contact ]]</dd>
    <dt ng-if="client.client_info.notes">Примечания</dt>
    <dd>[[ client.client_info.notes ]]</dd>
</dl>

<div id="main_info_tab" ng-show="editing_is_active()">
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="row">
                <div class="form-group col-md-3"
                     ng-class="{'has-error': client_form.lastname.$invalid && (client_form.lastname.$dirty || editing.submit_attempt)}">
                    <label for="lastname">Фамилия <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" autocomplete="off" placeholder="Фамилия"
                           id="lastname" name="lastname" ng-model="client.client_info.lastName" ng-required="true"/>
                </div>
                <div class="form-group col-md-3"
                     ng-class="{'has-error': client_form.firstname.$invalid && (client_form.firstname.$dirty || editing.submit_attempt)}">
                    <label for="lastname">Имя <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" autocomplete="off" placeholder="Имя"
                            id="firstname" name="firstname" ng-model="client.client_info.firstName" ng-required="true"/>
                </div>
                <div class="form-group col-md-3">
                    <label for="patronymic">Отчество</label>
                    <input type="text" class="form-control" autocomplete="off" placeholder="Отчество"
                           id="patronymic" name="patronymic" ng-model="client.client_info.patrName"/>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-3"
                     ng-class="{'has-error': client_form.birthdate.$invalid && (client_form.birthdate.$dirty || editing.submit_attempt)}">
                    <label for="birthdate">Дата рождения <span class="text-danger">*</span></label>
                    <wm-date id="birthdate" name="birthdate"
                             ng-model="client.client_info.birthDate"
                             ng-required="true">
                    </wm-date>
                </div>
                <div class="form-group col-md-2"
                     ng-class="{'has-error': client_form.gender.$invalid && (client_form.gender.$dirty || editing.submit_attempt)}">
                    <label for="gender">Пол <span class="text-danger">*</span></label>
                    <select class="form-control" id="gender" name="gender"
                            ng-model="client.client_info.sex"
                            ng-options="item as item.name for item in rbGender.objects track by item.id"
                            ng-required="true" enum-validator>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-3"
                     ng-class="{'has-error': client_form.snils.$invalid && client_form.snils.$dirty}">
                    <label for="snils">СНИЛС</label>
                    <input type="text" class="form-control" id="snils" name="snils" ui-mask="999-999-999 99"
                           ng-model="client.client_info.SNILS" placeholder="___-___-___ __"
                           ng-pattern="/\d{3}-\d{3}-\d{3} \d\d/" snils-validator />
                </div>
            </div>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading panel-title">Документ</div>
        <div class="panel-body">
            <ng-form name="docForm">
                <div class="row">
                    {# TODO: есть проблема с начальным значением селекта - оно всегда валидно, плюс непонятно как добавить выбор пустого значения #}
                    <div class="form-group col-md-4">
                        <label for="doc_type">Тип</label>
                        <ui-select class="form-control" id="doc_type" name="doc_type"
                                   ng-model="client.client_info['document']['documentType']"
                                   theme="select2" autocomplete="off">
                            <match placeholder="Тип документа">[[$select.selected.name]]</match>
                            <choices repeat="dt in rbDocumentType.objects | filter: $select.search">
                                <div ng-bind-html="dt.name | highlight: $select.search"></div>
                            </choices>
                        </ui-select>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': docForm.doc_serial.$invalid && docForm.doc_serial.$dirty}">
                        <label for="doc_serial">Серия</label>
                        <input type="text" class="form-control" id="doc_serial" name="doc_serial"
                               autocomplete="off" placeholder="серия"
                               ng-model="client.client_info.document.serial"
                               validator-regexp="client.client_info.document.documentType.validators.serial"/>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': docForm.doc_type.$viewValue && docForm.doc_number.$invalid}">
                        <label for="doc_number">Номер</label>
                        <input type="text" class="form-control" id="doc_number" name="doc_number"
                               autocomplete="off" placeholder="номер"
                               ng-model="client.client_info.document.number"
                               ng-required="docForm.doc_type.$viewValue"
                               validator-regexp="client.client_info.document.documentType.validators.number"/>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': docForm.doc_type.$viewValue && docForm.doc_begDate.$invalid}">
                        <label for="doc_begDate">Дата выдачи</label>
                        <wm-date id="doc_begDate" name="doc_begDate"
                                 ng-model="client.client_info['document']['begDate']"
                                 ng-required="docForm.doc_type.$viewValue">
                        </wm-date>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': docForm.doc_endDate.$invalid }">
                        <label for="doc_endDate">Действителен до</label>
                        {# TODO: неправильная установка даты, если в модели сейчас null #}
                        <wm-date id="doc_endDate" name="doc_endDate"
                                 ng-model="client.client_info['document']['endDate']">
                                 {# TODO: валидация для необязательной даты - только для введенного#}
                        </wm-date>
                    </div>
                    <div class="form-group col-md-4"
                         ng-class="{'has-error': docForm.doc_type.$viewValue && docForm.ufms.$invalid}">
                        <label for="ufms">Выдан</label>
                        <select class="form-control" id="ufms" name="ufms"
                                ng-model="client.client_info['document']['origin']"
                                ng-options="org.name as org.name for org in rbUFMS.objects"
                                ng-required="docForm.doc_type.$viewValue">
                        </select>
                        {# TODO: manual-input#}
                    </div>
                </div>
            </ng-form>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading panel-title">Полис ОМС</div>
        <div class="panel-body">
            <ng-form name="cpolForm">
                <div class="row">
                    <div class="form-group col-md-4">
                        <label for="cpol_type">Тип</label>
                        <ui-select class="form-control" id="cpol_type" name="cpol_type"
                                   ng-model="client.client_info['compulsoryPolicy']['policyType']"
                                   theme="select2" autocomplete="off">
                            <match placeholder="Тип полиса">[[$select.selected.name]]</match>
                            <choices repeat="pt in rbPolicyType.objects | filter: filter_cpolicy | filter: $select.search">
                                <div ng-bind-html="pt.name | highlight: $select.search"></div>
                            </choices>
                        </ui-select>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': cpolForm.cpol_serial.$invalid && cpolForm.cpol_serial.$dirty}">
                        <label for="cpol_serial">Серия</label>
                        <input type="text" class="form-control" id="cpol_serial" name="cpol_serial"
                               autocomplete="off" placeholder="серия"
                               ng-model="client.client_info.compulsoryPolicy.serial"
                               validator-regexp="client.client_info.compulsoryPolicy.policyType.validators.serial"/>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': cpolForm.cpol_type.$viewValue && cpolForm.cpol_number.$invalid}">
                        <label for="cpol_number">Номер</label>
                        <input type="text" class="form-control" id="cpol_number" name="cpol_number"
                               autocomplete="off" placeholder="номер"
                               ng-model="client.client_info.compulsoryPolicy.number"
                               ng-required="cpolForm.cpol_type.$viewValue"
                               validator-regexp="client.client_info.compulsoryPolicy.policyType.validators.number"/>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': cpolForm.cpol_type.$viewValue && cpolForm.cpol_begDate.$invalid}">
                        <label for="cpol_begDate">Дата выдачи</label>
                        <wm-date id="cpol_begDate" name="cpol_begDate"
                                 ng-model="client.client_info.compulsoryPolicy.begDate"
                                 ng-required="cpolForm.cpol_type.$viewValue">
                        </wm-date>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': cpolForm.cpol_endDate.$invalid }">
                        <label for="cpol_endDate">Действителен до</label>
                        {# TODO: неправильная установка даты, если в модели сейчас null #}
                        <wm-date id="cpol_endDate" name="cpol_endDate"
                                 ng-model="client.client_info.compulsoryPolicy.endDate">
                                 {# TODO: валидация для необязательной даты - только для введенного#}
                        </wm-date>
                    </div>
                    <div class="form-group col-md-4"
                         ng-class="{'has-error': cpolForm.cpol_type.$viewValue && cpolForm.ufms.$invalid}">
                        <label for="ufms">Выдан</label>
                        <ui-select class="form-control" id="ufms" name="ufms"
                                ng-model="client.client_info.compulsoryPolicy.insurer"
                                theme="select2" ng-required="cpolForm.cpol_type.$viewValue">
                            <match placeholder="Тип документа">[[$select.selected.short_name]]</match>
                            <choices repeat="org in rbOrganisation.objects | filter: $select.search">
                                <div ng-bind-html="org.short_name | highlight: $select.search"></div>
                            </choices>
                        </ui-select>
                    </div>
                </div>
            </ng-form>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading panel-title">Полис ДМС</div>
        <div class="panel-body">
            <ng-form name="vpolForm">
                <div class="row">
                    <div class="form-group col-md-4">
                        <label for="vpol_type">Тип</label>
                        <ui-select class="form-control" id="vpol_type" name="vpol_type"
                                   ng-model="client.client_info.voluntaryPolicy.policyType"
                                   theme="select2" autocomplete="off">
                            <match placeholder="Тип полиса">[[$select.selected.name]]</match>
                            <choices repeat="pt in rbPolicyType.objects | filter: filter_vpolicy | filter: $select.search">
                                <div ng-bind-html="pt.name | highlight: $select.search"></div>
                            </choices>
                        </ui-select>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': vpolForm.vpol_serial.$invalid && vpolForm.vpol_serial.$dirty}">
                        <label for="vpol_serial">Серия</label>
                        <input type="text" class="form-control" id="vpol_serial" name="vpol_serial"
                               autocomplete="off" placeholder="серия" ng-pattern="/^[\d\s]+$/" {# FIXME: its ok? #}
                               ng-model="client.client_info['voluntaryPolicy']['serial']"/>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': vpolForm.vpol_type.$viewValue && vpolForm.vpol_number.$invalid}">
                        <label for="vpol_number">Номер</label>
                        <input type="text" class="form-control" id="vpol_number" name="vpol_number"
                               autocomplete="off" placeholder="номер" ng-pattern="/^\d+$/" {# FIXME: allows whitespace as first char #}
                               ng-model="client.client_info['voluntaryPolicy']['number']"
                               ng-required="vpolForm.vpol_type.$viewValue"/>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': vpolForm.vpol_type.$viewValue && vpolForm.vpol_begDate.$invalid}">
                        <label for="vpol_begDate">Дата выдачи</label>
                        <wm-date id="vpol_begDate" name="vpol_begDate"
                                 ng-model="client.client_info['voluntaryPolicy']['begDate']"
                                 ng-required="vpolForm.vpol_type.$viewValue">
                        </wm-date>
                    </div>
                    <div class="form-group col-md-2"
                         ng-class="{'has-error': vpolForm.vpol_endDate.$invalid }">
                        <label for="vpol_endDate">Действителен до</label>
                        {# TODO: неправильная установка даты, если в модели сейчас null #}
                        <wm-date id="vpol_endDate" name="vpol_endDate"
                                 ng-model="client.client_info['voluntaryPolicy']['endDate']">
                                 {# TODO: валидация для необязательной даты - только для введенного#}
                        </wm-date>
                    </div>
                    <div class="form-group col-md-4"
                         ng-class="{'has-error': vpolForm.vpol_type.$viewValue && vpolForm.ufms.$invalid}">
                        <label for="ufms">Выдан</label>
                        <ui-select class="form-control" id="ufms" name="ufms"
                                ng-model="client.client_info['voluntaryPolicy']['insurer']"
                                theme="select2" ng-required="vpolForm.vpol_type.$viewValue">
                            <match placeholder="Тип документа">[[$select.selected.short_name]]</match>
                            <choices repeat="org in rbOrganisation.objects | filter: $select.search">
                                <div ng-bind-html="org.short_name | highlight: $select.search"></div>
                            </choices>
                        </ui-select>
                    </div>
                </div>
            </ng-form>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-body">
            <div class="row">
                <div class="form-group col-md-8">
                    <label for="notes">Примечания</label>
                    <textarea class="form-control" id="notes" name="notes" rows="3" autocomplete="off"></textarea>
                </div>
            </div>
         </div>
    </div>
</div>


