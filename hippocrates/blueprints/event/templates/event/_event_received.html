<div ng-controller="EventReceivedCtrl">
<ng-form name="event_received_form" role="form" toc-element="Информация о госпитализации" toc-name="tocEventForm">
    <div class="box box-info" ng-class="{'collapsed-box': !event.is_new()}">
        <div class="box-header with-border">
            <h3 class="box-title">Информация о госпитализации</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" ng-click="received_edit()" title="Редактировать" ng-if="event.received.status < 2">
                    <span class="glyphicon glyphicon-pencil text-primary"></span>
                </button>
                <button class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa" ng-class="{'fa-chevron-down': event.is_new(), 'fa-chevron-right': !event.is_new()}"></i>
                </button>
            </div>
        </div>
        <div class="box-body">
            <div ng-if="!event.is_new()">
                <table class="table table-condensed">
                    <thead>
                        <tr>
                            <th class="col-md-4"></th>
                            <th class="col-md-8"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th class="text-right">Кем направлен</th>
                            <td>[[ event.received.appointed_by.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Направивший врач</th>
                            <td>[[ event.received.appointment_doctor.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Дата направления</th>
                            <td>[[ event.received.appointment_date.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">№ направления</th>
                            <td>[[ event.received.appointment_number.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Кем доставлен</th>
                            <td>[[ event.received.delivered_by.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Отделение поступления</th>
                            <td>[[ event.received.orgStructStay.value.name ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">№ наряда СП</th>
                            <td>[[ event.received.ambulance_number.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Вид транспортировки</th>
                            <td>[[ event.received.transp_type.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Диагноз направившего учреждения</th>
                            <td>
                                <div>
                                    Основной:
                                    <span ng-repeat="diag in event.received.diagnoses | collapse_diagnoses:'main'">
                                        [[ diag.diagnostic.mkb.code ]] - [[ diag.diagnostic.mkb.name ]]
                                    </span>
                                </div>
                                <div ng-if="event.received.diagnoses | collapse_diagnoses:'complication' | count">
                                    Осложнения:
                                    <div ng-repeat="diag in event.received.diagnoses | collapse_diagnoses:'complication'">
                                        [[ diag.diagnostic.mkb.code ]] - [[ diag.diagnostic.mkb.name ]]
                                    </div>
                                </div>
                                <div ng-if="event.received.diagnoses | collapse_diagnoses:'associated' | count">
                                    Сопутствующие:
                                    <div ng-repeat="diag in event.received.diagnoses | collapse_diagnoses:'associated'">
                                        [[ diag.diagnostic.mkb.code ]] - [[ diag.diagnostic.mkb.name ]]
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th class="text-right">В состоянии опьянения</th>
                            <td>[[ event.received.intoxication.value ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Травма</th>
                            <td>[[ event.received.trauma.value.name ]]</td>
                        </tr>
                        <tr>
                            <th class="text-right">Доставлен от начала заболевания\травмы через</th>
                            <td>[[ event.received.delivered_after.value ]]</td>
                        </tr>
                        <tr>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div ng-if="event.is_new()">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <div class="form-group" ng-class="formstate.is_hospital() ? 'col-md-12' : 'col-md-3'">
                            <label for="appointed_by">Кем направлен</label>
                            <ui-select ng-model="event.received.appointed_by.value" theme="select2" class="form-control"
                                    autocomplete="off" id="appointed_by" name="appointed_by" no-undefined-value>
                                <ui-select-match allow-clear="true">[[ $select.selected ]]</ui-select-match>
                                <ui-select-choices repeat="item in event.received.appointed_by.type.domain_obj.values | filter: $select.search">
                                    <span ng-bind-html="item | highlight: $select.search"></span>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div class="form-group col-md-3" ng-if="!formstate.is_hospital()">
                            <label for="appointment_doctor">Направивший врач</label>
                            <input type="text" class="form-control" autocomplete="off"
                                   id="appointment_doctor" name="appointment_doctor" ng-model="event.received.appointment_doctor.value"/>
                        </div>
                        <div class="form-group col-md-3" ng-if="!formstate.is_hospital()">
                            <label for="appointment_number">№ направления</label>
                            <input type="text" class="form-control" autocomplete="off"
                                   id="appointment_number" name="appointment_number" ng-model="event.received.appointment_number.value"/>
                        </div>
                        <div class="col-md-3" ng-if="!formstate.is_hospital()">
                            <label for="appointment_date" class="control-label">Дата направления</label>
                            <wm-date id="appointment_date" name="appointment_date" ng-model="event.received.appointment_date.value">
                            </wm-date>
                        </div>
                    </div>
                    <div class="row marginal">
                        <div class="col-md-5">
                            <label for="orgStructDirectedFrom" class="control-label">Направлен из</label>
                            <ui-select id="orgStructDirectedFrom" name="orgStructDirectedFrom" theme="select2"
                                       ng-model="event.received.orgStructDirectedFrom.value" no-undefined-value>
                                <ui-select-match placeholder="Подразделение" allow-clear="true">[[$select.selected.name]]</ui-select-match>
                                <ui-select-choices repeat="os in OrgStructure.objects | filter: {show: 1} | filter: $select.search">
                                    <div ng-bind-html="os.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div class="col-md-3"
                             ng-class="{'has-error': event_received_form.hosp_order.$invalid && editing.submit_attempt}">
                            <label for="hosp_order" class="control-label">Порядок госпитализации</label>
                            <rb-select id="hosp_order" name="hosp_order" ng-model="event.received.hosp_order.value"
                                       ref-book="rbHospitalisationOrder" ng-required="true" no-undefined-value></rb-select>
                        </div>
                        <div class="col-md-4">
                            <label for="hosp_goal" class="control-label">Цель госпитализации</label>
                            <rb-select ng-model="event.received.hosp_goal.value" ref-book="rbHospitalisationGoal"
                                allow-clear="true" no-undefined-value></rb-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-5"
                             ng-class="{'has-error': event_received_form.org_structure.$invalid && editing.submit_attempt}">
                            <label for="org_structure" class="control-label">Отделение поступления</label>
                            <ui-select id="org_structure" name="org_structure" theme="select2"
                                       ng-model="event.received.orgStructStay.value" ng-required="true" no-undefined-value>
                                <ui-select-match placeholder="Подразделение">[[$select.selected.name]]</ui-select-match>
                                <ui-select-choices repeat="os in OrgStructure.objects |
                                    filter: {show: 1, hasHospitalBeds: formstate.is_hospital() ? 1 : ''} | filter: $select.search">
                                    <div ng-bind-html="os.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="delivered_by">Кем доставлен</label>
                            <ui-select ng-model="event.received.delivered_by.value" theme="select2" class="form-control"
                                    autocomplete="off" id="delivered_by" name="delivered_by" no-undefined-value>
                                <ui-select-match allow-clear="true">[[ $select.selected ]]</ui-select-match>
                                <ui-select-choices repeat="item in event.received.delivered_by.type.domain_obj.values | filter: $select.search">
                                    <span ng-bind-html="item | highlight: $select.search"></span>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="ambulance_number">№ наряда СП</label>
                            <input type="text" class="form-control" autocomplete="off"
                                   id="ambulance_number" name="ambulance_number" ng-model="event.received.ambulance_number.value"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <div class="form-group" ng-class="formstate.is_hospital() ? 'col-md-4' : 'col-md-5'">
                            <label for="delivered_after">Доставлен от начала заболевания\травмы через</label>
                            <ui-select ng-model="event.received.delivered_after.value" theme="select2" class="form-control"
                                    autocomplete="off" id="delivered_after" name="delivered_after" no-undefined-value>
                                <ui-select-match allow-clear="true">[[ $select.selected ]]</ui-select-match>
                                <ui-select-choices repeat="item in event.received.delivered_after.type.domain_obj.values | filter: $select.search">
                                    <span ng-bind-html="item | highlight: $select.search"></span>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div ng-class="{'col-md-2': formstate.is_hospital(), 'col-md-3': !formstate.is_hospital(),
                                        'has-error': event_received_form.transp_type.$invalid && editing.submit_attempt}">
                            <label for="transp_type" class="control-label">Вид транспортировки</label>
                            <ui-select id="transp_type" name="transp_type" theme="select2"
                                       ng-model="event.received.transp_type.value" ng-required="true" no-undefined-value>
                                <ui-select-match placeholder="Вид транспортировки">[[$select.selected]]</ui-select-match>
                                <ui-select-choices repeat="val in event.received.transp_type.type.domain_obj.values">
                                    <div ng-bind-html="val | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div class="form-group" ng-class="formstate.is_hospital() ? 'col-md-3' : 'col-md-4'">
                            <label for="intoxication">Доставлен в состоянии опьянения</label>
                            <ui-select ng-model="event.received.intoxication.value" theme="select2" class="form-control"
                                    autocomplete="off" id="intoxication" name="intoxication" no-undefined-value>
                                <ui-select-match allow-clear="true">[[ $select.selected ]]</ui-select-match>
                                <ui-select-choices repeat="item in event.received.intoxication.type.domain_obj.values | filter: $select.search">
                                    <span ng-bind-html="item | highlight: $select.search"></span>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div ng-if="formstate.is_hospital()" class="col-md-3">
                            <label for="hosp_order" class="control-label">Травма</label>
                            <rb-select ng-model="event.received.trauma.value" ref-book="rbTraumaType"
                                allow-clear="true" no-undefined-value></rb-select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default" ng-if="event.received.action_type.diagnosis_types">
                <div class="panel-body">
                    <h4>Диагноз</h4>
                    <input type="text" class="form-control" autocomplete="off"
                                   placeholder="Клиническое описание диагноза" id="directed_by" name="appointed_by"
                                   ng-model="event.received.diag_text.value"/>
                </div>
                <div class="panel-body">
                    <wm-diagnosis-new ng-model="event.received.diagnoses" can-edit="true"
                                      diag-types="event.received.action_type.diagnosis_types" can-add-new="true"></wm-diagnosis-new>
                </div>
            </div>
            <div class="panel panel-default" ng-if="!formstate.is_hospital()">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label for="hosp_order" class="control-label">Травма</label>
                            <rb-select ng-model="event.received.trauma.value" ref-book="rbTraumaType"
                                allow-clear="true" no-undefined-value></rb-select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row" ng-if="!formstate.is_hospital()">
                        <div class="form-group col-md-6">
                            <label>Артериальное давление. Левая рука</label>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Артериальное давление. Правая рука</label>
                        </div>
                    </div>
                    <div class="row marginal" ng-if="!formstate.is_hospital()">
                        <div class="form-group col-md-3">
                            <input type="text" class="form-control" autocomplete="off" valid-number valid-number-float
                                   id="directed_by" name="appointed_by" ng-model="event.received.lh_systolic.value"/>
                            <span>Сист., мм.рт.ст.</span>
                        </div>
                        <div class="form-group col-md-3">
                            <input type="text" class="form-control" autocomplete="off" valid-number valid-number-float
                                   id="direction_number" name="appointment_doctor" ng-model="event.received.lh_diastolic.value"/>
                            <span>Диаст., мм.рт.ст.</span>
                        </div>
                        <div class="form-group col-md-3">
                            <input type="text" class="form-control" autocomplete="off" valid-number valid-number-float
                                   id="directed_by" name="appointed_by" ng-model="event.received.rh_systolic.value"/>
                            <span>Сист., мм.рт.ст.</span>
                        </div>
                        <div class="form-group col-md-3">
                            <input type="text" class="form-control" autocomplete="off" valid-number valid-number-float
                                   id="direction_number" name="appointment_doctor" ng-model="event.received.rh_diastolic.value"/>
                            <span>Диаст., мм.рт.ст.</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-3">
                            <label for="directed_by">Температура</label>
                            <input type="text" class="form-control" autocomplete="off" valid-number valid-number-float
                                   id="directed_by" name="appointed_by" ng-model="event.received.temperature.value"/>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="direction_number">Вес при поступлении (кг)</label>
                            <input type="text" class="form-control" autocomplete="off" valid-number valid-number-float
                                   id="direction_number" name="appointment_doctor" ng-model="event.received.weight.value"/>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="directed_by">Рост (см)</label>
                            <input type="text" class="form-control" autocomplete="off" valid-number valid-number-float
                                   id="directed_by" name="appointed_by" ng-model="event.received.height.value"/>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
</ng-form>
<div>
</div>
</div>