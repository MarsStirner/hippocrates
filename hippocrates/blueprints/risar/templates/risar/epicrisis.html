{% extends 'risar/base.html' %}
{% import 'risar/_macros.html' as rimacros %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
    <div ng-controller="EpicrisisCtrl" ng-cloak>
        <ul class="breadcrumb">
            <li><a href="{{ url_for('.index_html') }}">Рабочий стол</a></li>
            <li><a ng-href="{{ url_for('.html_chart') }}?event_id=[[ chart.id ]]">Карта пациентки</a></li>
            <li>Эпикриз</li>
        </ul>
        <div class="row small-marginal">
            <div class="col-md-12">
                {{ rimacros.page_title('Эпикриз') }}
            </div>
        </div>
        <tabset>
            <tab heading="Информация о родоразрешении">
                <div class="panel panel-default" style="border-color: #ffffff;">
                    <div class="panel-body">
                        <span ng-if="chart.epicrisis" ng-bind-html="chart.epicrisis.info">
                        </span>
                        <div class="text-right"><a class="print_link" href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]"><span class="glyphicon glyphicon-pencil"></span> Изменить</a> </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-default">
                            <div class="panel-heading"> Диагнозы
                                <a class="print_link pull-right"
                                   href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_first"><span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-5 col-md-5  text-right">Основной диагноз:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.main_diagnosis.diagnosis.mkb.code]] - [[chart.epicrisis.main_diagnosis.diagnosis.mkb.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5  text-right">Сопутствующий диагноз:</div>
                                    <div class="col-sm-7 col-md-7"><span ng-repeat="diag in chart.epicrisis.attend_diagnosis" >[[diag.diagnosis.mkb.code]] - [[diag.diagnosis.mkb.name]]
                                    <span ng-if="chart.epicrisis.attend_diagnosis.length>1"><br></span></span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5  text-right">Диагноз осложнения:</div>
                                    <div class="col-sm-7 col-md-7"><span ng-repeat="diag in chart.epicrisis.complicating_diagnosis">[[diag.diagnosis.mkb.code]] - [[diag.diagnosis.mkb.name]]
                                    <span ng-if="chart.epicrisis.complicating_diagnosis.length>1"><br></span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-default">
                            <div class="panel-heading"> Данные случая
                                <a class="print_link pull-right"
                                   href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_first"><span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Дата постановки на учёт:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.set_date|asDate]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Срок беременности при постановке на учёт:</div>
                                    <div class="col-sm-6 col-md-6">
                                        <span tooltip="Рассчитывается исходя из текущего срока беременности, даты родоразрешения и даты постановки на учёт">[[chart.epicrisis.registration_pregnancy_week]]</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Число посещений акушера-гинеколога:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.checkups.length]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Прибавка массы, кг:</div>
                                    <div class="col-sm-6 col-md-6">[[weight_gain]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Особенности течения беременности:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.pregnancy_speciality]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" ng-if="chart.epicrisis.death_date || chart.epicrisis.reason_of_death">
                        <div class="panel panel-default">
                            <div class="panel-heading"> Смерть матери
                                <a class="print_link pull-right"
                                   href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_second"><span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Дата смерти:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.death_date|asDate]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Время смерти:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.death_time|asTime]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Причина смерти:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.reason_of_death]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Патологоанатомический диагноз:</div>
                                    <div class="col-sm-7 col-md-7"><span tooltip="[[ chart.epicrisis.pat_diagnosis.diagnosis.mkb.name ]]">[[chart.epicrisis.pat_diagnosis.diagnosis.mkb.code]]</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Заключение ЛКК:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.control_expert_conclusion]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-default">
                            <div class="panel-heading"> Осложнения при родах
                                <a class="print_link pull-right"
                                   href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_third"><span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Излитие околоплодных вод:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.delivery_waters.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Слабость родовых сил:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.weakness.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Разрыв промежностей (степень):</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.perineal_tear]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Анемия после родов (Hb<110 г/л):</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.poor_blood]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Нефропатия/эклампсия в родах:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.eclampsia.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Патология пуповины:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.funiculus.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Патология плаценты:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.afterbirth.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Инфекции в родах:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.infections_during_birth]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Инфекции после родов:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.infections_after_birth]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Другие осложнения при родах:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.other_complications]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-default">
                            <div class="panel-heading"> Пособия и манипуляции при родах
                                <a class="print_link pull-right"
                                   href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_fourth"><span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Вскрытие околоплодного пузыря:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.caul  ? 'да': 'нет']]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Ручное обследование матки:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.calfbed  ? 'да': 'нет']]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Эпизио/перинеотомия:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.perineotomy]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Ручное выделение последа:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.secundines ? 'да': 'нет']]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5 col-md-5 text-right">Другие пособия и манипуляции:</div>
                                    <div class="col-sm-7 col-md-7">[[chart.epicrisis.other_manipulations]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-default">
                            <div class="panel-heading"> Операции при родах
                                <a class="print_link pull-right"
                                   href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_fifth"><span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Кесарево сечение:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.caesarean_section.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Акушерские щипцы:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.obstetrical_forceps.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Вакуум-экстракция:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.vacuum_extraction ? 'да': 'нет']]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Показания к операции:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.indication.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Особенности операции:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.specialities.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Обезболивание:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.anesthetization.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Гистерэктомия:</div>
                                    <div class="col-md-6">[[chart.epicrisis.hysterectomy.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Осложнения:</div>
                                    <div class="col-sm-6 col-md-6"><span ng-repeat="diag in chart.epicrisis.operation_complication" tooltip="[[diag.diagnosis.mkb.name]]">[[diag.diagnosis.mkb.code]]
                                    <span ng-if="chart.epicrisis.operation_complication.length>1"><br></span></span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Плодоразрушающие операции:</div>
                                    <div class="col-sm-6 col-md-6">[[chart.epicrisis.embryotomy  ? 'да': 'нет']]</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">&nbsp;</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </tab>
            <tab heading="Информация о детях">
                <table class="table">
                    <thead>
                        <tr>
                            <th rowspan="2">№</th>
                            <th rowspan="2">Живой</th>
                            <th rowspan="2">Дата и время рождения</th>
                            <th rowspan="2">Пол</th>
                            <th rowspan="2">Масса, кг</th>
                            <th rowspan="2">Длина, см</th>
                            <th rowspan="2">Степень доношенности</th>
                            <th colspan="3">Оценка по Апгар на минуту жизни</th>
                            <th rowspan="2"></th>
                        </tr>
                        <tr>
                            <th>1</th>
                            <th>5</th>
                            <th>10</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="inspection in chart.epicrisis.newborn_inspections" ng-if="!is_empty(inspection)">
                            <td>[[$index+1]]</td>
                            <td ng-if="inspection.deleted" colspan="10" class="text-center">
                                Удалено. <a ng-click="newborn_inspection_restore(inspection)" style="cursor: pointer">Восстановить</a>?</td>
                            <td ng-if="!inspection.deleted">[[inspection.alive ? 'да': 'нет']]</td>
                            <td ng-if="!inspection.deleted">[[inspection.birth_date |asDate ]] [[inspection.birth_time]]</td>
                            <td ng-if="!inspection.deleted">[[inspection.sex.code == 'male' ? 'Мужской': 'Женский']]</td>
                            <td ng-if="!inspection.deleted">[[inspection.weight]]</td>
                            <td ng-if="!inspection.deleted">[[inspection.length]]</td>
                            <td ng-if="!inspection.deleted">[[inspection.maturity_rate.name]]</td>
                            <td ng-if="!inspection.deleted">[[inspection.apgar_score_1]]</td>
                            <td ng-if="!inspection.deleted">[[inspection.apgar_score_5]]</td>
                            <td ng-if="!inspection.deleted">[[inspection.apgar_score_10]]</td>
                            <td ng-if="!inspection.deleted" class="col-md-1 nowrap">
                                <a class="btn btn-primary" href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_child[[$index+1]]"><span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                                <a class="btn btn-danger" ng-click="newborn_inspection_delete(inspection)"><span class="glyphicon glyphicon-trash"></span> Удалить</a>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="10">&nbsp;</td>
                            <td>
                                <a class="btn btn-success"
                                   href="{{ url_for('.html_epicrisis_edit') }}?event_id=[[ chart.id ]]#tab_sixth"><span class="glyphicon glyphicon-plus"></span> Добавить</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </tab>
        </tabset>
    </div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script src="{{ url_for('.static', filename='js/risar.js', v=version) }}"></script>
    <script src="{{ url_for('.static', filename='js/epicrisis.js', v=version) }}"></script>
{% endblock %}