{% extends 'risar/base/base.html' %}
{% import 'risar/_macros.html' as rimacros with context %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
<div ng-controller="EpicrisisCtrl" ng-cloak>
    <section class="content-header" ng-controller="RisarHeaderCtrl">
        {{ rimacros.page_title_n('Ввод данных по эпикризу родоразрешения') }}
        {{ rimacros.navigation('[[ chart.id ]]') }}
    </section>
    <section class="content">
        <div rc-wizard="sampleWizard" id="sampleWizard"  class="wizard-container-6">
            <div class="row">
                <div class="col-sm-3">
                    <div class="box box-solid">
                        <div class="box-header with-border">
                            <h3 class="box-title">Шаги</h3>
                        </div>
                        <div class="box-body no-padding" id="bs-example-navbar-collapse-1">
                            <ul class="nav nav-pills nav-stacked"  id="EpicrisisTabs">
                                <li class="active">
                                    <a class="active" href="#first" data-toggle="tab">
                                        <span class="badge">1</span>
                                        <span>Общая информация</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#second" data-toggle="tab">
                                        <span class="badge">2</span>
                                        <span>Информация о смерти матери</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#third" data-toggle="tab">
                                        <span class="badge">3</span>
                                        <span>Осложнения при родах</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#fourth" data-toggle="tab">
                                        <span class="badge">4</span>
                                        <span>Пособия и манипуляции при родах</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#fifth" data-toggle="tab">
                                        <span class="badge">5</span>
                                        <span>Операции при родах</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#sixth" data-toggle="tab">
                                        <span class="badge">6</span>
                                        <span>Сведения о родившихся детях</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-sm-9">
                    <div class="tab-content">
                        <ng-form class="tab-pane active" id="first" name="firstForm"  novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 1. Общая информация</h3>
                                <div class="row" ng-class="{'has-error': firstForm.pregnancy_final.$invalid}" >
                                    <div class="col-md-3" for="pregnancy_final" class="control-label text-right" ng-bind-html="epicrisisDescriptor.getLabel('pregnancy_final')"></div>
                                    <div class="col-md-9" name="pregnancy_final" ng-model="epicrisis.pregnancy_final"
                                         refbook-radio ref-book="rbRisarPregnancy_Final"
                                         ng-disabled="epicrisisDescriptor.getReadOnly('pregnancy_final')" ng-required="epicrisisDescriptor.getMandatory('pregnancy_final')">
                                      [[ item.name ]]
                                    </div>
                                </div>
                            </div>
                            <div class="box-body">
                                <table class="table table-condensed" ng-if="epicrisis.pregnancy_final.code">
                                    <tbody>
                                        <tr>
                                            <th class="text-right col-md-4" ng-bind-html="epicrisisDescriptor.getLabel('arrival_date')"></th>
                                            <td class="col-md-8">
                                                <div class="row" ng-class="{'has-error': firstForm.arrival_date.$invalid && firstForm.submit_attempt}">
                                                <div class="col-md-2">
                                                    <wm-date ng-model="epicrisis.arrival_date" min-date="minDate" ng-disabled="epicrisisDescriptor.getReadOnly('arrival_date')"
                                                             style="width: 250px" ng-required="epicrisisDescriptor.getMandatory('arrival_date')" name="arrival_date"></wm-date>
                                                </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right col-md-4">[[epicrisis.pregnancy_final.code =='abortom'? 'Дата аборта': 'Дата родов']] <span class="text-danger">*</span></th>
                                            <td class="col-md-8">
                                                <div class="row" ng-class="{'has-error': firstForm.delivery_date.$invalid && firstForm.submit_attempt}">
                                                <div class="col-md-2">
                                                <wm-date ng-model="epicrisis.delivery_date" min-date="minDate" ng-disabled="epicrisisDescriptor.getReadOnly('delivery_date')"
                                                         style="width: 250px" ng-required="epicrisisDescriptor.getMandatory('delivery_date')" name="delivery_date"></wm-date>
                                                </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">[[ epicrisis.pregnancy_final.code =='abortom' ? 'Время аборта':'Время родов']] <span class="text-danger">*</span></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.delivery_time.$invalid && firstForm.submit_attempt}">
                                                    <div class="col-md-4">
                                                        <div fs-time ng-model="epicrisis.delivery_time" ng-disabled="epicrisisDescriptor.getReadOnly('delivery_time')"
                                                             name="delivery_time" ng-required="epicrisisDescriptor.getMandatory('delivery_time')"></div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">[[ epicrisis.pregnancy_final.code =='abortom' ? 'Аборт при сроке (недель)': 'Роды при сроке (недель)']] <span class="text-danger">*</span></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.pregnancy_duration.$invalid && firstForm.submit_attempt}">
                                                <div class="col-md-2  col-lg-2">
                                                    <input ng-model="epicrisis.pregnancy_duration" class="form-control" name="pregnancy_duration"
                                                           ng-disabled="epicrisisDescriptor.getReadOnly('pregnancy_duration')" ng-required="epicrisisDescriptor.getMandatory('pregnancy_duration')" valid-number type="number" min="[[min_pregnancy_duration]]" max="[[max_pregnancy_duration]]" maxlength="2">
                                                </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr ng-if="epicrisis.pregnancy_final.code =='rodami'">
                                            <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('LPU')"></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.LPU.$invalid  && firstForm.submit_attempt}">
                                                    <div class="col-md-7">
                                                    <ui-select ng-model="epicrisis.LPU" theme="select2" class="form-control" name="LPU"
                                                               ng-disabled="epicrisisDescriptor.getReadOnly('LPU')" ref-book="Organisation" autocomplete="off" ng-required="epicrisis.pregnancy_final.code =='rodami' && epicrisisDescriptor.getMandatory('LPU')">
                                                        <ui-select-match placeholder="не выбрано">[[ $select.selected.short_name ]]</ui-select-match>
                                                        <ui-select-choices repeat="item in $refBook.objects | organisation_filter | filter: $select.search | limitTo: 50">
                                                            <span ng-bind-html="item.full_name | highlight: $select.search"></span>
                                                        </ui-select-choices>
                                                    </ui-select>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('maternity_hosp_medico')"></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.maternity_hosp_medico.$invalid  && firstForm.submit_attempt}">
                                                    <div class="col-md-7">
                                                        <wm-person-select ng-model="epicrisis.maternity_hosp_medico" person-kind="onlyOrgPersons"
                                                            ng-disabled="epicrisisDescriptor.getReadOnly('maternity_hosp_medico')" filter-by="hospMedicoFilter" name="maternity_hosp_medico" ng-required="epicrisisDescriptor.getMandatory('maternity_hosp_medico')"></wm-person-select>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr ng-if="epicrisis.pregnancy_final.code =='rodami'">
                                            <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('newborn_LPU')"></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.newborn_LPU.$invalid  && firstForm.submit_attempt}">
                                                    <div class="col-md-7">
                                                    <ui-select ng-model="epicrisis.newborn_LPU" theme="select2" class="form-control" name="newborn_LPU"
                                                               ng-disabled="epicrisisDescriptor.getReadOnly('newborn_LPU')" ref-book="Organisation" autocomplete="off" ng-required="epicrisisDescriptor.getMandatory('newborn_LPU')">
                                                        <ui-select-match placeholder="не выбрано">[[ $select.selected.short_name ]]</ui-select-match>
                                                        <ui-select-choices repeat="item in $refBook.objects | organisation_filter | filter: $select.search | limitTo: 50">
                                                            <span ng-bind-html="item.full_name | highlight: $select.search"></span>
                                                        </ui-select-choices>
                                                    </ui-select>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr ng-if="epicrisis.pregnancy_final.code =='abortom'">
                                            <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('abort')"></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.state.$invalid  && firstForm.submit_attempt}">
                                                    <div class="col-md-3">
                                                        <rb-select name="state" ng-model="epicrisis.abort" ng-disabled="epicrisisDescriptor.getReadOnly('abort')"
                                                                   ref-book="rbRisarAbort" ng-required="epicrisis.pregnancy_final.code =='abortom' && epicrisisDescriptor.getMandatory('abort')"></rb-select>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <wm-diagnosis-new ng-model="epicrisis.diagnoses" diag-types="epicrisis.diagnosis_final" can-add-new="true" can-edit="! epicrisis.endDate"></wm-diagnosis-new>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('pregnancy_speciality')"></th>
                                            <td>
                                                <div class="row"><div class="col-md-12">
                                                    <wysiwyg ng-model="epicrisis.pregnancy_speciality" />
                                                </div></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('afterbirth_features')"></th>
                                            <td>
                                                <div class="row"><div class="col-md-12">
                                                    <wysiwyg ng-model="epicrisis.afterbirth_features" />
                                                </div></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('help')"></th>
                                            <td>
                                                <div class="row"><div class="col-md-12">
                                                    <wysiwyg ng-model="epicrisis.help" />
                                                </div></div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="second" name="secondForm"  novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 2. Информация о смерти матери</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <td class="text-right bold col-md-4">Смерть матери<span>&nbsp;</span></td>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="mother_death" ng-change="clear_death_info">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right bold" ng-bind-html="epicrisisDescriptor.getLabel('reason_of_death')"></td>
                                        <td><div class="row"
                                                 ng-class="{'has-error': secondForm.reason_of_death.$invalid && secondForm.submit_attempt}">
                                            <div class="col-md-3">
                                            <input ng-model="epicrisis.reason_of_death" class="form-control"
                                                   ng-required="mother_death && epicrisisDescriptor.getMandatory('reason_of_death')" name="reason_of_death" ng-disabled="!mother_death || epicrisisDescriptor.getReadOnly('reason_of_death')">
                                            </div></div>
                                        </td>

                                    </tr>
                                    <tr>
                                        <td class="text-right bold" ng-bind-html="epicrisisDescriptor.getLabel('death_date')"></td>
                                        <td>
                                            <wm-date name="death_date" ng-disabled="!mother_death || epicrisisDescriptor.getReadOnly('death_date')" min-date="epicrisis.delivery_date"
                                                     ng-class="{'has-error': secondForm.death_date.$invalid && secondForm.submit_attempt}"
                                                     ng-required="mother_death && epicrisisDescriptor.getMandatory('death_date')" ng-model="epicrisis.death_date" style="width: 250px"></wm-date>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right bold" ng-bind-html="epicrisisDescriptor.getLabel('death_time')"></td>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4" ng-class="{'has-error': secondForm.death_time.$invalid}">
                                            <div fs-time ng-model="epicrisis.death_time" ng-required="mother_death && epicrisisDescriptor.getMandatory('death_time')"
                                                 name="death_time" ng-disabled="!mother_death || epicrisisDescriptor.getReadOnly('death_time')"></div>
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <div class="row">
                                                <wm-diagnosis-new ng-model="epicrisis.diagnoses" can-add-new="true" can-edit="!! mother_death && ! epicrisis.endDate"
                                                  diag-types="epicrisis.diagnosis_pathanatomical"></wm-diagnosis-new>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right"><span tooltip="Заключение лечебно-контрольной комиссии"
                                                                     ng-bind-html="epicrisisDescriptor.getLabel('control_expert_conclusion')"></span></td>
                                        <td>
                                            <div class="row"><div class="col-md-12">
                                                <wysiwyg ng-model="epicrisis.control_expert_conclusion" contenteditable="mother_death"/>
                                            </div></div>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="third" name="thirdForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 3. Осложнения при родах</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('immaturity')"></th>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="epicrisis.immaturity"
                                                   ng-required="epicrisisDescriptor.getMandatory('immaturity')" ng-disabled="epicrisisDescriptor.getReadOnly('immaturity')">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right col-md-4" ng-bind-html="epicrisisDescriptor.getLabel('delivery_waters')"></th>
                                        <td class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.delivery_waters" ref-book="rbRisarDelivery_Waters"
                                                    ng-required="epicrisisDescriptor.getMandatory('delivery_waters')" ng-disabled="epicrisisDescriptor.getReadOnly('delivery_waters')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('pre_birth_delivery_waters')"></th>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="epicrisis.pre_birth_delivery_waters"
                                            ng-required="epicrisisDescriptor.getMandatory('pre_birth_delivery_waters')" ng-disabled="epicrisisDescriptor.getReadOnly('pre_birth_delivery_waters')">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('weakness')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.weakness" ref-book="rbRisarWeakness"
                                                    ng-required="epicrisisDescriptor.getMandatory('weakness')" ng-disabled="epicrisisDescriptor.getReadOnly('weakness')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('perineal_tear')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.perineal_tear" ref-book="rbPerinealTear"
                                                    ng-required="epicrisisDescriptor.getMandatory('perineal_tear')" ng-disabled="epicrisisDescriptor.getReadOnly('perineal_tear')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('meconium_colouring')"></th>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="epicrisis.meconium_colouring"
                                            ng-required="epicrisisDescriptor.getMandatory('meconium_colouring')" ng-disabled="epicrisisDescriptor.getReadOnly('meconium_colouring')">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('patologicsl_preliminal_period')"></th>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="epicrisis.patologicsl_preliminal_period"
                                            ng-required="epicrisisDescriptor.getMandatory('patologicsl_preliminal_period')" ng-disabled="epicrisisDescriptor.getReadOnly('patologicsl_preliminal_period')">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('labor_anomalies')"></th>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="epicrisis.labor_anomalies"
                                            ng-required="epicrisisDescriptor.getMandatory('labor_anomalies')" ng-disabled="epicrisisDescriptor.getReadOnly('labor_anomalies')">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('chorioamnionit')"></th>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="epicrisis.chorioamnionit"
                                            ng-required="epicrisisDescriptor.getMandatory('chorioamnionit')" ng-disabled="epicrisisDescriptor.getReadOnly('chorioamnionit')">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('poor_blood')"></th>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="epicrisis.poor_blood"
                                            ng-required="epicrisisDescriptor.getMandatory('poor_blood')" ng-disabled="epicrisisDescriptor.getReadOnly('poor_blood')">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('eclampsia')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.eclampsia" ref-book="rbRisarEclampsia"
                                                    ng-required="epicrisisDescriptor.getMandatory('eclampsia')" ng-disabled="epicrisisDescriptor.getReadOnly('eclampsia')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('funiculus')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.funiculus" ref-book="rbRisarFuniculus"
                                                    ng-required="epicrisisDescriptor.getMandatory('funiculus')" ng-disabled="epicrisisDescriptor.getReadOnly('funiculus')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('afterbirth')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.afterbirth" ref-book="rbRisarAfterbirth"
                                                    ng-required="epicrisisDescriptor.getMandatory('afterbirth')" ng-disabled="epicrisisDescriptor.getReadOnly('afterbirth')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('infections_during_birth')"></th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.infections_during_birth" class="form-control"
                                                ng-required="epicrisisDescriptor.getMandatory('infections_during_birth')" ng-disabled="epicrisisDescriptor.getReadOnly('infections_during_birth')">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('infections_after_birth')"></th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.infections_after_birth" class="form-control"
                                                ng-required="epicrisisDescriptor.getMandatory('infections_after_birth')" ng-disabled="epicrisisDescriptor.getReadOnly('infections_after_birth')">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="fourth" name="fourthForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 4. Пособия и манипуляции при родах</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <th class="text-right col-md-4" ng-bind-html="epicrisisDescriptor.getLabel('caul')"></th>
                                        <td class="col-md-8"><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.caul = true" ng-checked="epicrisis.caul"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('caul')">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.caul = false" ng-checked="!epicrisis.caul"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('caul')">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('calfbed')"></th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.calfbed = true" ng-checked="epicrisis.calfbed"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('calfbed')">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.calfbed = false" ng-checked="!epicrisis.calfbed"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('calfbed')">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('perineotomy')"></th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.perineotomy" class="form-control"
                                                    ng-required="epicrisisDescriptor.getMandatory('perineotomy')"
                                                    ng-disabled="epicrisisDescriptor.getReadOnly('perineotomy')">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('secundines')"></th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.secundines = true" ng-checked="epicrisis.secundines"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('secundines')">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.secundines = false" ng-checked="!epicrisis.secundines"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('secundines')">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('other_manipulations')"></th>
                                        <td>
                                            <div class="row"><div class="col-md-12">
                                                <wysiwyg ng-model="epicrisis.other_manipulations" />
                                            </div></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="fifth" name="fifthForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 5. Операции при родах</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <th class="text-right col-md-4" ng-bind-html="epicrisisDescriptor.getLabel('caesarean_section')"></th>
                                        <td class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.caesarean_section" ref-book="rbRisarCaesarean_Section"
                                                    ng-required="epicrisisDescriptor.getMandatory('caesarean_section')"
                                                    ng-disabled="epicrisisDescriptor.getReadOnly('caesarean_section')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('obstetrical_forceps')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.obstetrical_forceps" ref-book="rbRisarObstetrical_Forceps"
                                                    ng-required="epicrisisDescriptor.getMandatory('obstetrical_forceps')"
                                                    ng-disabled="epicrisisDescriptor.getReadOnly('obstetrical_forceps')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('vacuum_extraction')"></th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.vacuum_extraction = true" ng-checked="epicrisis.vacuum_extraction"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('vacuum_extraction')">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.vacuum_extraction = false" ng-checked="!epicrisis.vacuum_extraction"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('vacuum_extraction')">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('indication')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.indication" ref-book="rbRisarIndication"
                                                    ng-required="epicrisisDescriptor.getMandatory('indication')"
                                                    ng-disabled="epicrisisDescriptor.getReadOnly('indication')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('specialities')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.specialities" ref-book="rbRisarSpecialities"
                                                    ng-required="epicrisisDescriptor.getMandatory('specialities')"
                                                    ng-disabled="epicrisisDescriptor.getReadOnly('specialities')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('anesthetization')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.anesthetization" ref-book="rbRisarAnesthetization"
                                                    ng-required="epicrisisDescriptor.getMandatory('anesthetization')"
                                                    ng-disabled="epicrisisDescriptor.getReadOnly('anesthetization')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('hysterectomy')"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.hysterectomy" ref-book="rbRisarHysterectomy"
                                                    ng-required="epicrisisDescriptor.getMandatory('hysterectomy')"
                                                    ng-disabled="epicrisisDescriptor.getReadOnly('hysterectomy')"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('operation_complication')"></th>
                                        <td>
                                            <div class="row">
                                                <wm-mkb-multiple ng-model="epicrisis.operation_complication"></wm-mkb-multiple>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right" ng-bind-html="epicrisisDescriptor.getLabel('embryotomy')"></th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.embryotomy = true" ng-checked="epicrisis.embryotomy"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('embryotomy')">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.embryotomy = false" ng-checked="!epicrisis.embryotomy"
                                                ng-disabled="epicrisisDescriptor.getReadOnly('embryotomy')">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="sixth" name="sixthForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 6. Сведения о родившихся детях</h3>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-primary text-left marginal" ng-click="add_child()"><span class="glyphicon glyphicon-plus"></span> Добавить</button>
                                        <ul class="nav nav-pills nav-stacked  marginal" id="childrenTabs">
                                            <li ng-class="{'active': $index==0}" ng-repeat="child in epicrisis.newborn_inspections | flt_not_deleted">
                                                <a href="#child[[$index+1]]" data-toggle="pill">
                                                    Ребенок [[$index+1]]<button class="text-red close btn btn-small btn-default closeBtn"
                                                                                ng-click="delete_child(child)" type="button"
                                                                                tooltip="Удалить">
                                                                            <span class="glyphicon glyphicon-remove"></span>
                                                                        </button>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-10">
                                        <div class="tab-content">
                                            <div ng-class="{'active': $index==0}" class="tab-pane" id="child[[$index+1]]" ng-repeat="child in epicrisis.newborn_inspections | flt_not_deleted">
                                                <table class="table">
                                                    <tbody>
                                                        <tr>
                                                            <th class="text-right col-md-4">Живой <span class="text-danger">*</span></th>
                                                            <td class="col-md-8">
                                                                <div ng-class="{'has-error': sixthForm.optionsAlive_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                    <div class="radio-inline">
                                                                        <label>
                                                                            <input type="radio" name="optionsAlive_[[$index]]"
                                                                                   ng-model="child.alive" data-ng-value="true" ng-change="alive_changed(child)" required>
                                                                            Да
                                                                        </label>
                                                                    </div>
                                                                    <div class="radio-inline">
                                                                        <label>
                                                                            <input type="radio" name="optionsAlive_[[$index]]"
                                                                                   ng-model="child.alive" data-ng-value="false" ng-change="alive_changed(child)" required>
                                                                            Нет
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">Пол <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div ng-class="{'has-error': sixthForm.optionsSex_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                <div class="radio-inline">
                                                                    <label>
                                                                        <input type="radio" name="optionsSex_[[$index]]"
                                                                               ng-model="child.sex.code" value = "male" required>
                                                                        мужской
                                                                    </label>
                                                                </div>
                                                                <div class="radio-inline">
                                                                    <label>
                                                                        <input type="radio" name="optionsSex_[[$index]]"
                                                                               ng-model="child.sex.code" value = "female" required>
                                                                        женский
                                                                    </label>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <th class="text-right">Вес <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.weight_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                <div class="col-md-3 col-lg-2">
                                                                    <input ng-model="child.weight" ng-required="true" class="form-control"
                                                                        name="weight_[[$index]]" valid-number maxlength="4">
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">Длина <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.length_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                <div class="col-md-3 col-lg-2">
                                                                    <input ng-model="child.length" ng-required="true" valid-number maxlength="3"
                                                                           class="form-control" name="length_[[$index]]">
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">[[child.alive == false ? 'Дата смерти' : 'Дата рождения']] <span class="text-danger">*</span></th>
                                                            <td>
                                                                <wm-date ng-model="child.date" ng-required="true"
                                                                         ng-class="{'has-error': sixthForm.date_[[$index]].$invalid && sixthForm.submit_attempt}"
                                                                         style="width: 250px" name="date_[[$index]]" min-date="epicrisis.delivery_date"></wm-date>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">[[child.alive == false ? 'Время смерти' : 'Время рождения']] <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.time_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                    <div class="col-md-3">
                                                                        <div fs-time ng-required="true"
                                                                             ng-model="child.time" name="time_[[$index]]"></div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <th class="text-right">Степень доношенности <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.maturity_rate_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                    <div class="col-md-4">
                                                                    <rb-select ng-model="child.maturity_rate" ng-required="true"
                                                                               ref-book="rbRisarMaturity_Rate" name="maturity_rate_[[$index]]"></rb-select>
                                                                </div></div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <th class="text-right">Оценка по Апгар <span>&nbsp;</span></th>
                                                            <td>&nbsp;
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <td class="text-right">на 1 минуту жизни <span>&nbsp;</span></td>
                                                            <td>
                                                                <div class="row">
                                                                <div class="col-md-2">
                                                                    <input name="first_minute" ng-model="child.apgar_score_1"
                                                                           class="form-control" type="number"
                                                                           min="0" max="10" valid-number/>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <td class="text-right">на 5 минуту жизни <span>&nbsp;</span></td>
                                                            <td>
                                                                <div class="row">
                                                                <div class="col-md-2">
                                                                    <input name="fifth_minute" ng-model="child.apgar_score_5"
                                                                           class="form-control" type="number"
                                                                           min="0" max="10" valid-number/>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <td class="text-right">на 10 минуту жизни <span>&nbsp;</span></td>
                                                            <td>
                                                                <div class="row">
                                                                <div class="col-md-2">
                                                                    <input name="tenth_minute" ng-model="child.apgar_score_10"
                                                                           class="form-control" type="number"
                                                                           min="0" max="10" valid-number/>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">Заболевания новорождённого <span>&nbsp;</span></th>
                                                            <td>
                                                                <wm-mkb-multiple ng-model="child.diseases"></wm-mkb-multiple>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive==false">
                                                            <th class="text-right">Причина смерти <span class="text-danger">*</span></th>
                                                            <td>
                                                                <input ng-model="child.death_reasons" class="form-control">
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </ng-form>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-offset-3 col-md-9 col-sm-offset-3 col-sm-9">
                    <div class="box-footer">
                        <div class="pull-right">
                        <a class="pseudo-btn" ng-href="{{ url_for('.html_epicrisis') }}?event_id=[[ chart.id ]]">Перейти на форму эпикриза пациентки</a>
{#                        <ui-print-button ng-show="rc.sampleWizard.currentIndex == 5" ps="ps_epicrisis"#}
{#                                         resolve="ps_resolve()" before-print="save(rc.sampleWizard.currentStep.formController)">Печать</ui-print-button>#}
                        <button ng-show="rc.sampleWizard.currentIndex == 5 && epicrisis.printing_action_id" ng-click="print_self()"
                                type="button" class="btn btn-default"><i class="glyphicon glyphicon-print"></i>Печать</button>
                        <a class="btn btn-success"
                           ng-disabled="is_save_disabled(rc.sampleWizard)"
                           tooltip="[[rc.sampleWizard.currentStep.formController.$invalid && rc.sampleWizard.currentStep.formController.submit_attempt ? 'Заполните все обязательные поля': '']]"
                           ng-click="save(rc.sampleWizard.currentStep.formController)">
                            Сохранить</a>
                        <a class="btn btn-primary"
                           ng-disabled="is_save_disabled(rc.sampleWizard)"
                           ng-click="save(rc.sampleWizard.currentStep.formController); rc.sampleWizard.forward()"
                           tooltip="[[rc.sampleWizard.currentStep.formController.$invalid && rc.sampleWizard.currentStep.formController.submit_attempt ? 'Заполните все обязательные поля': '']]"
                           ng-show="rc.sampleWizard.currentIndex < rc.sampleWizard.navigationLength">
                            Сохранить и продолжить
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </section>
</div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script>
        WebMis20.value('epicrisis_descriptor', angular.fromJson('{{epicrisis_descriptor|tojson|safe}}'));
    </script>
    <script src="{{ url_for('.static', filename='js/epicrisis.js', v=app_version) }}"></script>
    <script src="{{ url_for('static', filename='js/services/event/event-services.js', v=app_version) }}"></script>
{% endblock %}