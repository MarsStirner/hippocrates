{% extends 'risar/base.html' %}
{% import 'risar/_macros.html' as rimacros %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
<div ng-controller="EpicrisisCtrl" ng-cloak>
    <section class="content-header">
        {{ rimacros.page_title_n('Ввод данных по эпикризу родоразрешения') }}
        <div class="novmargin">
            <div class="btn-group">
                <a ng-href="{{ url_for('.html_chart') }}?event_id=[[ chart.id ]]" class="btn btn-default">Карта пациентки</a>
                <a ng-href="{{ url_for('.html_anamnesis') }}?event_id=[[ chart.id ]]" class="btn btn-default">Анамнез</a>
                <a ng-href="{{ url_for('.html_inspection') }}?event_id=[[ chart.id ]]" class="btn btn-default">Осмотры</a>
                <a ng-href="{{ url_for('.html_routing') }}?event_id=[[ chart.id ]]&emergency=1" class="btn btn-default">Маршрутизация</a>
                <a ng-href="{{ url_for('.html_epicrisis') }}?event_id=[[ chart.id ]]" class="btn btn-primary">Эпикриз</a>
                <a ng-class="{disabled: !ps.is_available()}" ng-click="open_print_window()" class="btn btn-default">Печать</a>
                <div class="btn-group">
                    <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Дополнительно <span class="fa fa-caret-down"></span></button>
                    <ul role="menu" class="dropdown-menu">
                        <li><a ng-href="{{ url_for('.html_event_diagnoses') }}?event_id=[[ chart.id ]]">Диагнозы случая</a></li>
                        <li><a ng-href="{{ url_for('.html_event_measure') }}?event_id=[[ chart.id ]]">Мероприятия случая</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <section class="content">
        <div rc-wizard="sampleWizard" id="sampleWizard"  class="wizard-container-7">
            <div class="row">
                <div class="col-sm-3">
                    <div class="box box-solid">
                        <div class="box-header with-border">
                            <h3 class="box-title">Шаги</h3>
                        </div>
                        <div class="box-body no-padding" id="bs-example-navbar-collapse-1">
                            <ul class="nav nav-pills nav-stacked"  id="EpicrisisTabs">
                                <li class="active">
                                    <a class="active" href="#first" data-toggle="tab">
                                        <span class="badge">1</span>
                                        <span>Общая информация</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#second" data-toggle="tab">
                                        <span class="badge">2</span>
                                        <span>Информация о смерти матери</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#third" data-toggle="tab">
                                        <span class="badge">3</span>
                                        <span>Осложнения при родах</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#fourth" data-toggle="tab">
                                        <span class="badge">4</span>
                                        <span>Пособия и манипуляции при родах</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#fifth" data-toggle="tab">
                                        <span class="badge">5</span>
                                        <span>Операции при родах</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#sixth" data-toggle="tab">
                                        <span class="badge">6</span>
                                        <span>Сведения о родившихся детях</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#last" data-toggle="tab">
                                        <span class="badge">7</span>
                                        <span>Закрытие случая</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-sm-9">
                    <div class="tab-content">
                        <ng-form class="tab-pane active" id="first" name="firstForm"  novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 1. Общая информация</h3>
                                <div class="row" ng-class="{'has-error': firstForm.pregnancy_final.$invalid}" >
                                    <div class="col-md-3" for="pregnancy_final" class="control-label text-right">Беременность закончилась</div>
                                    <div class="col-md-9" name="pregnancy_final" ng-model="epicrisis.pregnancy_final"
                                         refbook-radio ref-book="rbRisarPregnancy_Final" ng-required="true">
                                      [[ item.name ]]
                                    </div>
                                </div>
                            </div>
                            <div class="box-body">
                                <table class="table table-condensed" ng-if="epicrisis.pregnancy_final.code">
                                    <tbody>
                                        <tr>
                                            <th class="text-right col-md-4">[[epicrisis.pregnancy_final.code =='abortom'? 'Дата аборта': 'Дата родов']]  <span class="text-danger">*</span></th>
                                            <td class="col-md-8">
                                                <div class="row" ng-class="{'has-error': firstForm.delivery_date.$invalid && firstForm.submit_attempt}">
                                                <div class="col-md-2">
                                                <wm-date ng-model="epicrisis.delivery_date"
                                                         style="width: 250px" ng-required="true"
                                                         name="delivery_date"></wm-date>
                                                </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">[[ epicrisis.pregnancy_final.code =='abortom' ? 'Время аборта':'Время родов']]  <span class="text-danger">*</span></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.delivery_time.$invalid && firstForm.submit_attempt}">
                                                    <div class="col-md-4">
                                                        <div fs-time ng-model="epicrisis.delivery_time"
                                                             name="delivery_time" ng-required="true"></div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">[[ epicrisis.pregnancy_final.code =='abortom' ? 'Аборт при сроке (недель)': 'Роды при сроке (недель)']]  <span class="text-danger">*</span></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.pregnancy_duration.$invalid && firstForm.submit_attempt}">
                                                <div class="col-md-2  col-lg-2">
                                                    <input ng-model="epicrisis.pregnancy_duration" class="form-control" name="pregnancy_duration"
                                                           ng-required="true">
                                                </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr ng-if="epicrisis.pregnancy_final.code =='rodami'">
                                            <th class="text-right">ЛПУ родоразрешения  <span class="text-danger">*</span></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.LPU.$invalid  && firstForm.submit_attempt}">
                                                    <div class="col-md-7">
                                                    <ui-select ng-model="epicrisis.LPU" theme="select2" class="form-control" name="LPU"
                                                               ref-book="Organisation" autocomplete="off" ng-required="epicrisis.pregnancy_final.code =='rodami'">
                                                        <ui-select-match placeholder="не выбрано">[[ $select.selected.short_name ]]</ui-select-match>
                                                        <ui-select-choices repeat="item in $refBook.objects | organisation_filter | filter: $select.search | limitTo: 50">
                                                            <span ng-bind-html="item.full_name | highlight: $select.search"></span>
                                                        </ui-select-choices>
                                                    </ui-select>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr ng-if="epicrisis.pregnancy_final.code =='abortom'">
                                            <th class="text-right">Вид аборта  <span class="text-danger">*</span></th>
                                            <td>
                                                <div class="row" ng-class="{'has-error': firstForm.state.$invalid  && firstForm.submit_attempt}">
                                                    <div class="col-md-3">
                                                        <rb-select name="state" ng-model="epicrisis.abort"
                                                                   ref-book="rbRisarAbort" ng-required="epicrisis.pregnancy_final.code =='abortom'"></rb-select>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">Основной диагноз <span class="text-danger">*</span></th>
                                            <td>
    {#                                            ng-class="{'has-error': firstForm.main_diagnosis.$invalid && firstForm.submit_attempt}"#}
                                                <wm-diagnosis model="epicrisis.main_diagnosis" list-mode="false"
                                                              can-add-new="true" can-delete="true" can-edit="true"
                                                              action="epicrisis" event="chart" risar="true"
                                                              params="{defaults:{diagnosis_type:rbDiagnosisType.get_by_code('2')},
                                                                       disabled:{diagnosis_type:true}}"></wm-diagnosis>

                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">Сопутствующий диагноз <span>&nbsp;</span></th>
                                            <td>
                                                <wm-diagnosis model="epicrisis.attend_diagnosis" list-mode="true"
                                                              can-add-new="true" can-delete="true" can-edit="true"
                                                              action="epicrisis" event="chart" risar="true"
                                                              params="{defaults:{diagnosis_type:rbDiagnosisType.get_by_code('9')},
                                                                       disabled:{diagnosis_type:true}}"></wm-diagnosis>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">Диагноз осложнения <span>&nbsp;</span></th>
                                            <td>
                                                <wm-diagnosis model="epicrisis.complicating_diagnosis" list-mode="true"
                                                              can-add-new="true" can-delete="true" can-edit="true"
                                                              action="epicrisis" event="chart" risar="true"
                                                              params="{defaults:{diagnosis_type:rbDiagnosisType.get_by_code('3')},
                                                                       disabled:{diagnosis_type:true}}"></wm-diagnosis>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">Особенности течения беременности <span>&nbsp;</span></th>
                                            <td>
                                                <div class="row"><div class="col-md-12">
                                                    <wysiwyg ng-model="epicrisis.pregnancy_speciality" />
                                                </div></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="text-right">Оказанная помощь <span>&nbsp;</span></th>
                                            <td>
                                                <div class="row"><div class="col-md-12">
                                                    <wysiwyg ng-model="epicrisis.help" />
                                                </div></div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="second" name="secondForm"  novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 2. Информация о смерти матери</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <td class="text-right col-md-4">Смерть матери <span>&nbsp;</span></td>
                                        <td class="col-md-8">
                                            <input type="checkbox" ng-model="mother_death" ng-change="clear_death_info">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right">Причина смерти матери <span class="text-danger">*</span></td>
                                        <td><div class="row"
                                                 ng-class="{'has-error': secondForm.reason_of_death.$invalid && secondForm.submit_attempt}">
                                            <div class="col-md-3">
                                            <input ng-model="epicrisis.reason_of_death" class = "form-control"
                                                   ng-required="mother_death" name="reason_of_death" ng-disabled="!mother_death">
                                            </div></div>
                                        </td>

                                    </tr>
                                    <tr>
                                        <td class="text-right">Дата смерти матери <span class="text-danger">*</span></td>
                                        <td>
                                            <wm-date name="death_date" ng-disabled="!mother_death"
                                                     ng-class="{'has-error': secondForm.death_date.$invalid && secondForm.submit_attempt}"
                                                     ng-required="mother_death" ng-model="epicrisis.death_date" style="width: 250px"></wm-date>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right">Время смерти матери <span class="text-danger">*</span></td>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4" ng-class="{'has-error': secondForm.death_time.$invalid}">
                                            <div fs-time ng-model="epicrisis.death_time" ng-required="mother_death"
                                                 name="death_time" ng-disabled="!mother_death"></div>
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right">Патологоанатомический диагноз <span class="text-danger">*</span></td>
                                        <td>
                                            <div class="row">
    {#                                            ng-class="{'has-error': secondForm.pat_diagnosis.$invalid && secondForm.submit_attempt}"#}
                                                <wm-diagnosis model="epicrisis.pat_diagnosis" list-mode="false"
                                                              can-add-new="true" can-delete="true" can-edit="true"
                                                              action="epicrisis" event="chart" risar="true"
                                                              disabled="!mother_death"
                                                              params="{defaults:{diagnosis_type:rbDiagnosisType.get_by_code('2')},
                                                                       required:{end_date:true}}"></wm-diagnosis>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right"><span tooltip="Заключение лечебно-контрольной комиссии">Заключение ЛКК <span>&nbsp;</span></span></td>
                                        <td>
                                            <div class="row"><div class="col-md-12">
                                                <wysiwyg ng-model="epicrisis.control_expert_conclusion" contenteditable="mother_death"/>
                                            </div></div>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="third" name="thirdForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 3. Осложнения при родах</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <th class="text-right col-md-4">Излитие околоплодных вод</th>
                                        <td class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.delivery_waters" ref-book="rbRisarDelivery_Waters"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Слабость родовых сил</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.weakness" ref-book="rbRisarWeakness"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Разрыв промежностей (степень)</th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.perineal_tear" class="form-control">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Анемия после родов (Hb<110 г/л)</th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.poor_blood" class="form-control">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Нефропатия/эклампсия в родах</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.eclampsia" ref-book="rbRisarEclampsia"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Патология пуповины</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.funiculus" ref-book="rbRisarFuniculus"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Патология плаценты</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.afterbirth" ref-book="rbRisarAfterbirth"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Инфекции в родах</th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.infections_during_birth" class="form-control">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Инфекции после родов</th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.infections_after_birth" class="form-control">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Другие осложнения при родах</th>
                                        <td>
                                            <div class="row"><div class="col-md-12">
                                                <wysiwyg ng-model="epicrisis.other_complications" />
                                            </div></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="fourth" name="fourthForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 4. Пособия и манипуляции при родах</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <th class="text-right col-md-4">Вскрытие околоплодного пузыря</th>
                                        <td class="col-md-8"><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.caul = true" ng-checked="epicrisis.caul">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.caul = false" ng-checked="!epicrisis.caul">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Ручное обследование матки</th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.calfbed = true" ng-checked="epicrisis.calfbed">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.calfbed = false" ng-checked="!epicrisis.calfbed">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Эпизио/перинеотомия</th>
                                        <td>
                                            <div class="row">
                                            <div class="col-md-4">
                                                <input ng-model="epicrisis.perineotomy" class="form-control">
                                            </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Ручное выделение последа</th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.secundines = true" ng-checked="epicrisis.secundines">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.secundines = false" ng-checked="!epicrisis.secundines">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Другие пособия и манипуляции</th>
                                        <td>
                                            <div class="row"><div class="col-md-12">
                                                <wysiwyg ng-model="epicrisis.other_manipulations" />
                                            </div></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="fifth" name="fifthForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 5. Операции при родах</h3>
                            </div>
                            <div class="box-body">
                            <table class="table table-condensed">
                                <tbody>
                                    <tr>
                                        <th class="text-right col-md-4">Кесарево сечение</th>
                                        <td class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.caesarean_section" ref-book="rbRisarCaesarean_Section"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Акушерские щипцы</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.obstetrical_forceps" ref-book="rbRisarObstetrical_Forceps"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Вакуум-экстракция</th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.vacuum_extraction = true" ng-checked="epicrisis.vacuum_extraction">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.vacuum_extraction = false" ng-checked="!epicrisis.vacuum_extraction">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Показания к операции</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.indication" ref-book="rbRisarIndication"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Особенности операции</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.specialities" ref-book="rbRisarSpecialities"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Обезболивание</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.anesthetization" ref-book="rbRisarAnesthetization"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Гистерэктомия</th>
                                        <td>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <rb-select name="state" ng-model="epicrisis.hysterectomy" ref-book="rbRisarHysterectomy"></rb-select>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Осложнения операции</th>
                                        <td>
                                            <div class="row">
                                                <wm-diagnosis model="epicrisis.operation_complication" list-mode="true"
                                                              can-add-new="true" can-delete="true" can-edit="true"
                                                              action="epicrisis" event="chart" risar="true"
                                                              params="{defaults:{diagnosis_type:rbDiagnosisType.get_by_code('2')}}"></wm-diagnosis>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="text-right">Плодоразрушающие операции</th>
                                        <td><div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.embryotomy = true" ng-checked="epicrisis.embryotomy">
                                                Да
                                            </label>
                                        </div>
                                        <div class="radio-inline">
                                            <label>
                                                <input type="radio" ng-click="epicrisis.embryotomy = false" ng-checked="!epicrisis.embryotomy">
                                                Нет
                                            </label>
                                        </div>
                                        </div></td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="sixth" name="sixthForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 6. Сведения о родившихся детях</h3>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-primary text-left marginal" ng-click="add_child()"><span class="glyphicon glyphicon-plus"></span> Добавить</button>
                                        <ul class="nav nav-pills nav-stacked  marginal" id="childrenTabs">
                                            <li ng-class="{'active': $index==0}" ng-repeat="child in epicrisis.newborn_inspections"><a href="#child[[$index+1]]" data-toggle="pill"> Ребенок [[$index+1]]</a></li>
                                        </ul>
                                    </div>
                                    <div class="col-md-10">
                                        <div class="tab-content">
                                            <div ng-class="{'active': $index==0}" class="tab-pane" id="child[[$index+1]]" ng-repeat="child in epicrisis.newborn_inspections">
                                                <table class="table">
                                                    <tbody>
                                                        <tr>
                                                            <th class="text-right col-md-4">Живой <span class="text-danger">*</span></th>
                                                            <td class="col-md-8">
                                                                <div ng-class="{'has-error': sixthForm.optionsAlive_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                    <div class="radio-inline">
                                                                        <label>
                                                                            <input type="radio" name="optionsAlive_[[$index]]"
                                                                                   ng-model="child.alive" data-ng-value="true" ng-change="alive_changed(child)" required>
                                                                            Да
                                                                        </label>
                                                                    </div>
                                                                    <div class="radio-inline">
                                                                        <label>
                                                                            <input type="radio" name="optionsAlive_[[$index]]"
                                                                                   ng-model="child.alive" data-ng-value="false" ng-change="alive_changed(child)" required>
                                                                            Нет
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">Пол <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div ng-class="{'has-error': sixthForm.optionsSex_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                <div class="radio-inline">
                                                                    <label>
                                                                        <input type="radio" name="optionsSex_[[$index]]"
                                                                               ng-model="child.sex.code" value = "male" required>
                                                                        мужской
                                                                    </label>
                                                                </div>
                                                                <div class="radio-inline">
                                                                    <label>
                                                                        <input type="radio" name="optionsSex_[[$index]]"
                                                                               ng-model="child.sex.code" value = "female" required>
                                                                        женский
                                                                    </label>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <th class="text-right">Вес <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.weight_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                <div class="col-md-3 col-lg-2">
                                                                    <input ng-model="child.weight" ng-required="true" class="form-control" name="weight_[[$index]]">
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">Длина <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.length_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                <div class="col-md-3 col-lg-2">
                                                                    <input ng-model="child.length" ng-required="true"
                                                                           class="form-control" name="length_[[$index]]">
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">[[child.alive == false ? 'Дата смерти' : 'Дата рождения']] <span class="text-danger">*</span></th>
                                                            <td>
                                                                <wm-date ng-model="child.date" ng-required="true"
                                                                         ng-class="{'has-error': sixthForm.date_[[$index]].$invalid && sixthForm.submit_attempt}"
                                                                         style="width: 250px" name="date_[[$index]]"></wm-date>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="text-right">[[child.alive == false ? 'Время смерти' : 'Время рождения']] <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.time_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                    <div class="col-md-3">
                                                                        <div fs-time ng-required="true"
                                                                             ng-model="child.time" name="time_[[$index]]"></div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <th class="text-right">Степень доношенности <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.maturity_rate_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                    <div class="col-md-4">
                                                                    <rb-select ng-model="child.maturity_rate" ng-required="true"
                                                                               ref-book="rbRisarMaturity_Rate" name="maturity_rate_[[$index]]"></rb-select>
                                                                </div></div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <th class="text-right">Оценка по Апгар <span>&nbsp;</span></th>
                                                            <td>&nbsp;
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <td class="text-right">на 1 минуту жизни <span>&nbsp;</span></td>
                                                            <td>
                                                                <div class="row">
                                                                <div class="col-md-2">
                                                                    <input name="first_minute" ng-model="child.apgar_score_1"
                                                                           class="form-control" type="number"
                                                                           min="0" max="10" valid-number/>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <td class="text-right">на 5 минуту жизни <span>&nbsp;</span></td>
                                                            <td>
                                                                <div class="row">
                                                                <div class="col-md-2">
                                                                    <input name="fifth_minute" ng-model="child.apgar_score_5"
                                                                           class="form-control" type="number"
                                                                           min="0" max="10" valid-number/>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive">
                                                            <td class="text-right">на 10 минуту жизни <span>&nbsp;</span></td>
                                                            <td>
                                                                <div class="row">
                                                                <div class="col-md-2">
                                                                    <input name="tenth_minute" ng-model="child.apgar_score_10"
                                                                           class="form-control" type="number"
                                                                           min="0" max="10" valid-number/>
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr ng-if="child.alive==false">
                                                            <th class="text-right">Причина смерти <span class="text-danger">*</span></th>
                                                            <td>
                                                                <div class="row" ng-class="{'has-error': sixthForm.death_reason_[[$index]].$invalid && sixthForm.submit_attempt}">
                                                                <div class="col-md-3">
                                                                    <input ng-model="child.death_reason" ng-required="true" class="form-control" name="death_reason_[[$index]]">
                                                                </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </ng-form>
                        <ng-form class="tab-pane" id="last" name="lastForm" novalidate rc-submit rc-step>
                            <div class="box box-primary box-wizard">
                            <div class="box-header">
                                <h3 class="box-title">Шаг 7. Закрытие случая</h3>
                                </div>
                            <div class="box-body">
                            <div class="row">
                                <div class="col-md-4 text-right">
                                    Дата закрытия случая
                                </div>
                                <div class="col-md-8">
                                    <wm-date ng-class="{'has-error': lastForm.exec_date.$invalid}" name="exec_date"
                                             ng-model="chart.exec_date" style="width: 250px" ng-required="true"></wm-date>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4  text-right">
                                    Время закрытия случая
                                </div>
                                <div class="col-md-8">
                                    <wm-time ng-class="{'has-error': lastForm.exec_time.$invalid}" name="exec_time"
                                             ng-model="chart.exec_date" style="width: 250px" ng-required="true"></wm-time>
                                </div>
                            </div>
                            </div>
                            </div>
                        </ng-form>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-offset-3 col-md-9 col-sm-offset-3 col-sm-9">
                    <div class="box-footer">
                        <div class="pull-right">
                        <a class="pseudo-btn" ng-href="{{ url_for('.html_epicrisis') }}?event_id=[[ chart.id ]]">Перейти на форму эпикриза пациентки</a>
                        <ui-print-button ng-show="rc.sampleWizard.currentIndex == 5" ps="ps_epicrisis"
                                         resolve="ps_resolve()" before-print="save(rc.sampleWizard.currentStep.formController)">Печать</ui-print-button>
                        <a class="btn btn-success"
                           ng-disabled="is_save_disabled(rc.sampleWizard)"
                           tooltip="[[rc.sampleWizard.currentStep.formController.$invalid && rc.sampleWizard.currentStep.formController.submit_attempt ? 'Заполните все обязательные поля': '']]"
                           ng-click="rc.sampleWizard.currentIndex == rc.sampleWizard.navigationLength ? close_event() : save(rc.sampleWizard.currentStep.formController)">
                            Сохранить</a>
                        <a class="btn btn-primary"
                           ng-disabled="is_save_disabled(rc.sampleWizard)"
                           ng-click="save(rc.sampleWizard.currentStep.formController); rc.sampleWizard.forward()"
                           tooltip="[[rc.sampleWizard.currentStep.formController.$invalid && rc.sampleWizard.currentStep.formController.submit_attempt ? 'Заполните все обязательные поля': '']]"
                           ng-show="rc.sampleWizard.currentIndex < rc.sampleWizard.navigationLength">
                            Сохранить и продолжить
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </section>
</div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script src="{{ url_for('.static', filename='js/epicrisis.js', v=version) }}"></script>
    <script src="{{ url_for('.static', filename='js/risar.js', v=version) }}"></script>
    <script src="{{ url_for('static', filename='js/services/event/event-services.js', v=version) }}"></script>
{% endblock %}