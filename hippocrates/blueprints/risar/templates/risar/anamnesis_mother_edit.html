{% extends 'risar/base/base.html' %}
{% import 'risar/_macros.html' as rimacros with context %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
<div ng-controller="AnamnesisMotherEditCtrl" ng-cloak>
    <section class="content-header" ng-controller="RisarHeaderCtrl">
        {{ rimacros.page_title_n('Ввод данных о матери') }}
        {{ rimacros.navigation('[[ event_id ]]') }}
    </section>
    <section class="content">
            <ng-form name="anamnesisMotherForm" id="anamnesisMotherForm" role="form" novalidate>
            <div class="box-body">
            <table class="table table-condensed title-right">
                <thead>
                <tr>
                    <th class="col-md-4"></th>
                    <th class="col-md-8"></th>
                </tr>
                </thead>
                <tbody>
                {% if 'education' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('education')"></th>
                    <td><rb-select ng-model="anamnesis_mother.education" ref-book="rbRisarEducation" autofocus="autofocus"
                                   ng-required="motherAnamnesisDescriptor.getMandatory('education')"
                                   ng-disabled="motherAnamnesisDescriptor.getReadOnly('education')"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'work_group' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('work_group')"></th>
                    <td><rb-select ng-model="anamnesis_mother.work_group" ref-book="rbRisarWork_Group"
                                   ng-required="motherAnamnesisDescriptor.getMandatory('work_group')"
                                   ng-disabled="motherAnamnesisDescriptor.getReadOnly('work_group')"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'professional_properties' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('professional_properties')"></th>
                    <td><rb-select ng-model="anamnesis_mother.professional_properties" ref-book="rbRisarProfessional_Properties"
                                   ng-required="motherAnamnesisDescriptor.getMandatory('professional_properties')"
                                   ng-disabled="motherAnamnesisDescriptor.getReadOnly('professional_properties')"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'marital_status' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('marital_status')"></th>
                    <td><rb-select ng-model="anamnesis_mother.marital_status" ref-book="rbRisarMarital_Status"
                                   ng-required="motherAnamnesisDescriptor.getMandatory('marital_status')"
                                   ng-disabled="motherAnamnesisDescriptor.getReadOnly('marital_status')"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'family_income' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('family_income')"></th>
                    <td><rb-select ng-model="anamnesis_mother.family_income" ref-book="rbRisarFamily_Income"
                                   ng-required="motherAnamnesisDescriptor.getMandatory('family_income')"
                                   ng-disabled="motherAnamnesisDescriptor.getReadOnly('family_income')"></rb-select></td>
                </tr>
                {% endif %}
                <tr>
                    <th class="text-right">Группа крови и резус-фактор</th>
                    <td><div class="row"><div class="col-md-4"><rb-select ng-model="anamnesis_mother.blood_type" ref-book="rbBloodType"></rb-select></div></div></td>
                </tr>
                {% if 'menstruation_last_date' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('menstruation_last_date')"></th>
                    <td><wm-date ng-model="anamnesis_mother.menstruation_last_date"
                            max-date="menstruation_max_date" min-date="menstruation_min_date" style="width: 250px"></wm-date></td>
                </tr>
                {% endif %}
                <tr>
                    <th class="text-right">Менструации</th>
                    <td>&nbsp;</td>
                </tr>
                {% if 'menstruation_start_age' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('menstruation_start_age')"></td>
                    <td><div class="row"><div class="col-md-4">
                        <input ng-model="anamnesis_mother.menstruation_start_age" class="form-control"
                               ng-required="motherAnamnesisDescriptor.getMandatory('menstruation_start_age')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('menstruation_start_age')"></div></div></td>
                </tr>
                {% endif %}
                {% if 'menstruation_duration' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('menstruation_duration')"></td>
                    <td><div class="row"><div class="col-md-4">
                        <input ng-model="anamnesis_mother.menstruation_duration" class="form-control"
                               ng-required="motherAnamnesisDescriptor.getMandatory('menstruation_duration')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('menstruation_duration')"></div></div></td>
                </tr>
                {% endif %}
                {% if 'menstruation_period' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('menstruation_period')"></td>
                    <td><div class="row"><div class="col-md-4">
                        <input ng-model="anamnesis_mother.menstruation_period" class="form-control"
                               ng-required="motherAnamnesisDescriptor.getMandatory('menstruation_period')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('menstruation_period')"></div></div></td>
                </tr>
                {% endif %}
                {% if 'menstruation_disorders' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('menstruation_disorders')"></td>
                    <td><input ng-model="anamnesis_mother.menstruation_disorders" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('menstruation_disorders')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('menstruation_disorders')"></td>
                </tr>
                {% endif %}
                {% if 'sex_life_start_age' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('sex_life_start_age')"></th>
                    <td><div class="row"><div class="col-md-4">
                        <input ng-model="anamnesis_mother.sex_life_start_age" class="form-control" valid-number maxlength="3" type="text" valid-number
                               ng-required="motherAnamnesisDescriptor.getMandatory('sex_life_start_age')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('sex_life_start_age')"></div></div></td>
                </tr>
                {% endif %}
                {% if 'contraception' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('contraception')"></th>
                    <td><rb-select multiple="true" ref-book="rbContraception" ng-model="anamnesis_mother.contraception" class="form-control"
                               ng-required="motherAnamnesisDescriptor.getMandatory('contraception')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('contraception')"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'fertilization_type' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('fertilization_type')"></th>
                    <td><rb-select ref-book="rbRisarFertilizationMethod" ng-model="anamnesis_mother.fertilization_type" class="form-control"
                               ng-required="motherAnamnesisDescriptor.getMandatory('fertilization_type')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('fertilization_type')"></rb-select></td>
                </tr>
                    <tr ng-show="isAttemptVisible">
                        <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('attempt_number')"></th>
                        <td>
                            <div class="row">
                                <div class="col-md-4">
                            <input ng-model="anamnesis_mother.attempt_number" class="form-control" valid-number maxlength="2" type="text"
                                   ng-required="motherAnamnesisDescriptor.getMandatory('attempt_number')"
                                   ng-disabled="motherAnamnesisDescriptor.getReadOnly('attempt_number')">
                                </div>
                            </div>
                        </td>
                    </tr>
                     {%- if 'attempt_number' in mother_anamnesis_descriptor -%}
                    {%- endif -%}
                {% endif %}
                {% if 'intrauterine' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('intrauterine')"></th>
                    <td><input ng-model="anamnesis_mother.intrauterine" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('intrauterine')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('intrauterine')"></td>
                </tr>
                {% endif %}
                {% if 'multifetation' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('multifetation')"></th>
                    <td><input ng-model="anamnesis_mother.multifetation" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('multifetation')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('multifetation')"></td>
                </tr>
                {% endif %}
                {% if 'infertility' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('infertility')"></th>
                    <td><input ng-model="anamnesis_mother.infertility" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('infertility')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('infertility')"></td>
                </tr>
                {% endif %}
                {% if 'infertility_type' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('infertility_type')"></td>
                    <td><rb-select ref-book="rbRisarInfertility_Type" ng-model="anamnesis_mother.infertility_type"
                        ng-disabled="!anamnesis_mother.infertility"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'infertility_period' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('infertility_period')"></td>
                    <td><input ng-model="anamnesis_mother.infertility_period" class="form-control" valid-number maxlength="3" type="text" valid-number ng-disabled="!anamnesis_mother.infertility"></td>
                </tr>
                {% endif %}
                {% if 'infertility_treatment' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('infertility_treatment')"></td>
                    <td><rb-select multiple="true" ref-book="rbRisarInfertilityTreatment" ng-model="anamnesis_mother.infertility_treatment"
                        ng-disabled="!anamnesis_mother.infertility"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'infertility_cause' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('infertility_cause')"></td>
                    <td><rb-select multiple="true" ref-book="rbRisarInfertilityEtiology" ng-model="anamnesis_mother.infertility_cause"
                        ng-disabled="!anamnesis_mother.infertility"></rb-select></td>
                </tr>
                {% endif %}
                {% if 'finished_diseases' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('finished_diseases')"></th>
                    <td><wm-mkb-multiple ng-model="anamnesis_mother.finished_diseases"
                               ng-required="motherAnamnesisDescriptor.getMandatory('finished_diseases')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('finished_diseases')"></wm-mkb-multiple></td>
                </tr>
                {% endif %}
                {% if 'finished_diseases_text' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('finished_diseases_text')"></th>
                    <td><wysiwyg ng-model="anamnesis_mother.finished_diseases_text" /></td>
                </tr>
                {% endif %}
                {% if 'hereditary' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('hereditary')"></th>
                    <td><rb-select multiple="true" ref-book="rbRisarHereditary" ng-model="anamnesis_mother.hereditary"
                               ng-required="motherAnamnesisDescriptor.getMandatory('hereditary')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('hereditary')"
                               limit-to=50></rb-select></td>
                </tr>
                    {%- if 'hereditary_defect' in mother_anamnesis_descriptor -%}
                        <tr ng-show="isHeredTextVisible">
                            <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('hereditary_defect')"></td>
                            <td><wysiwyg ng-model="anamnesis_mother.hereditary_defect" /></td>
                        </tr>
                    {%- endif -%}
                {% endif %}
                {% if 'current_diseases' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('current_diseases')"></th>
                    <td><wm-mkb-multiple ng-model="anamnesis_mother.current_diseases"
                               ng-required="motherAnamnesisDescriptor.getMandatory('current_diseases')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('current_diseases')"></wm-mkb-multiple></td>
                </tr>
                {% endif %}
                {% if 'current_diseases_text' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('current_diseases_text')"></th>
                    <td><wysiwyg ng-model="anamnesis_mother.current_diseases_text" /></td>
                </tr>
                {% endif %}
                {% if 'heart_disease' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('heart_disease')"></th>
                    <td><input ng-model="anamnesis_mother.heart_disease" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('heart_disease')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('heart_disease')"></td>
                </tr>
                {% endif %}
                {% if 'preeclampsia' in mother_anamnesis_descriptor %}
                <tr>
                    <th class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('preeclampsia')"></th>
                    <td><input ng-model="anamnesis_mother.preeclampsia" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('preeclampsia')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('preeclampsia')"></td>
                </tr>
                {% endif %}
                <tr>
                    <th class="text-right">Вредные привычки <span>&nbsp;</span></th>
                    <td>&nbsp;</td>
                </tr>
                {% if 'alcohol' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('alcohol')"></td>
                    <td><input ng-model="anamnesis_mother.alcohol" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('alcohol')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('alcohol')"></td>
                </tr>
                {% endif %}
                {% if 'smoking' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('smoking')"></td>
                    <td><input ng-model="anamnesis_mother.smoking" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('smoking')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('smoking')"></td>
                </tr>
                {% endif %}
                {% if 'toxic' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('toxic')"></td>
                    <td><input ng-model="anamnesis_mother.toxic" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('toxic')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('toxic')"></td>
                </tr>
                {% endif %}
                {% if 'drugs' in mother_anamnesis_descriptor %}
                <tr>
                    <td class="text-right" ng-bind-html="motherAnamnesisDescriptor.getLabel('drugs')"></td>
                    <td><input ng-model="anamnesis_mother.drugs" class="checkbox" type="checkbox"
                               ng-required="motherAnamnesisDescriptor.getMandatory('drugs')"
                               ng-disabled="motherAnamnesisDescriptor.getReadOnly('drugs')"></td>
                </tr>
                {% endif %}
                </tbody>
            </table>
            </div>
            </ng-form>
            <div class="box-footer text-right">
                <a class="pseudo-btn" ng-href="{{ url_for('.html_anamnesis') }}?event_id=[[ event_id ]]">Перейти на форму анамнеза пациентки</a>
                <button class="btn btn-success"
                        tooltip="[[anamnesisMotherForm.$invalid && submit_attempt ? 'Заполните все обязательные поля': '']]"
                        ng-click="save()">Сохранить</button>
            </div>
    </section>
</div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script>
        WebMis20.value('mother_anamnesis_descriptor', angular.fromJson('{{mother_anamnesis_descriptor|tojson|safe}}'));
    </script>
    <script src="{{ url_for('.static', filename='js/anamnesis.js', v=app_version) }}"></script>
    <script src="{{ url_for('static', filename='js/services/event/event-services.js', v=app_version) }}"></script>
{% endblock %}