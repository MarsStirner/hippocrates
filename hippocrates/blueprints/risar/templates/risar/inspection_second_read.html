{% extends 'risar/base/base.html' %}
{% import 'risar/_macros.html' as rimacros %}

{% block title %}> Повторный осмотр{% endblock %}

{% block main %}
<div ng-controller="CheckupFirstEditCtrl" ng-cloak>
    <section class="content-header">
        {{ rimacros.page_title_n('Повторный осмотр') }}
        {{ rimacros.navigation('[[ event_id ]]') }}
    </section>
    <section class="content">
        <tabset>
            <tab heading="Данные женщины">
                <div class="row">
                    <div class="col-md-6">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">Лист динамического наблюдения</h3>
                                <a class="print_link pull-right" ng-if="!checkup.end_date"
                                   href="{{ url_for('.html_inspection_edit') }}?event_id=[[ header.event.id ]]&checkup_id=[[ checkup.id ]]#tab_common">
                                    <span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Дата осмотра:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.beg_date|asDateTime]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Масса при осмотре:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.weight]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">АД правая рука</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.ad_right_high]]/[[checkup.ad_right_low]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">АД левая рука</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.ad_left_high]]/[[checkup.ad_left_low]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right"><b>Комментарии к анализам</b></div>
                                    <div class="col-sm-6 col-md-6"></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Мочи:</div>
                                    <div class="col-sm-6 col-md-6 long-words">[[checkup.urine]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Крови:</div>
                                    <div class="col-sm-6 col-md-6 long-words">[[checkup.blood]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">УЗИ:</div>
                                    <div class="col-sm-6 col-md-6 long-words">[[checkup.us]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Другое:</div>
                                    <div class="col-sm-6 col-md-6 long-words">[[checkup.other_analysis]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">Соматический статус</h3>
                                <a class="print_link pull-right" ng-if="!checkup.end_date"
                                   href="{{ url_for('.html_inspection_edit') }}?event_id=[[ header.event.id ]]&checkup_id=[[ checkup.id ]]#tab_somatic">
                                    <span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Общее состояние:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.state.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Жалобы</div>
                                    <div class="col-sm-6 col-md-6"><span ng-repeat="elem in checkup.complaints" >[[elem.name]][[$last ? '' : ', ']]</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Отеки:</div>
                                    <div class="col-sm-6 col-md-6 long-words" ng-bind-html="checkup.edema"></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Кожа</div>
                                    <div class="col-sm-6 col-md-6"><span ng-repeat="elem in checkup.skin" >[[elem.name]][[$last ? '' : ', ']]</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Лимфоузлы</div>
                                    <div class="col-sm-6 col-md-6"><span ng-repeat="elem in checkup.lymph_nodes" >[[elem.name]][[$last ? '' : ', ']]</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Молочные железы</div>
                                    <div class="col-sm-6 col-md-6"><span ng-repeat="elem in checkup.breast" >[[elem.name]][[$last ? '' : ', ']]</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Состояние сосков </div>
                                    <div class="col-sm-6 col-md-6"><span ng-repeat="elem in checkup.nipples" >[[elem.name]][[$last ? '' : ', ']]</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Выделения</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.secretion.name]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Физиологические отправления</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.bowel_and_bladder_habits]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">Акушерский статус</h3>
                                <a class="print_link pull-right" ng-if="!checkup.end_date"
                                   href="{{ url_for('.html_inspection_edit') }}?event_id=[[ header.event.id ]]&checkup_id=[[ checkup.id ]]#tab_obstetrician">
                                    <span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Окружность живота:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.abdominal]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Высота стояния дна матки:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.fundal_height]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6 text-right">Состояние матки:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.metra_state.name]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">Заключение</h3>
                                <a class="print_link pull-right" ng-if="!checkup.end_date"
                                   href="{{ url_for('.html_inspection_edit') }}?event_id=[[ header.event.id ]]&checkup_id=[[ checkup.id ]]#tab_conclusion">
                                    <span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="box-body">
                                <!-- TODO: Отображение диагнозов -->
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Основной диагноз:</div>
                                    <div class="col-sm-6 col-md-6">
                                        <div ng-repeat="diag in checkup.diagnoses | collapse_diagnoses:'main'">
                                            [[diag.diagnostic.mkb.code]] - [[diag.diagnostic.mkb.name]]
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Сопутствующие диагнозы:</div>
                                    <div class="col-sm-6 col-md-6">
                                        <div ng-repeat="diag in checkup.diagnoses | collapse_diagnoses:'associated'">
                                            [[diag.diagnostic.mkb.code]] - [[diag.diagnostic.mkb.name]]
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Диагноз осложнения:</div>
                                    <div class="col-sm-6 col-md-6">
                                        <div ng-repeat="diag in checkup.diagnoses | collapse_diagnoses:'complication'">
                                            [[diag.diagnostic.mkb.code]] - [[diag.diagnostic.mkb.name]]
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Срок беременности:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.pregnancy_week]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Возможность сохранения беременности:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.pregnancy_continuation ? 'да': 'нет']]</div>
                                </div>
                                <div class="row" ng-show="!pregContRefusalDisabled()">
                                    <div class="col-sm-6 col-md-6  text-right">Отказ от прерывания:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.pregnancy_continuation_refusal ? 'да': 'нет']]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Витаминизация:</div>
                                    <div class="col-md-6 long-words" ng-bind-html="checkup.fortification"></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Коррекция питания:</div>
                                    <div class="col-md-6 long-words" ng-bind-html="checkup.nutrition"></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Лечение:</div>
                                    <div class="col-md-6 long-words" ng-bind-html="checkup.treatment"></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Плановая дата следующей явки:</div>
                                    <div class="col-sm-6 col-md-6">[[checkup.next_date|asDate]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Примечания:</div>
                                    <div class="col-sm-6 col-md-6 long-words" ng-bind-html="checkup.notes"></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 col-md-6  text-right">Рекомендации:</div>
                                    <div class="col-md-6 long-words" ng-bind-html="checkup.recommendations"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">Мероприятия</h3>
                                <a class="print_link pull-right" ng-if="!checkup.end_date"
                                   href="{{ url_for('.html_inspection_edit') }}?event_id=[[ header.event.id ]]&checkup_id=[[ checkup.id ]]#tab_diagnostic">
                                    <span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="box-body">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th width="30%">Название мероприятия</th>
                                            <th>Дата начала</th>
                                            <th>Дата окончания</th>
                                            <th>Статус</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="measure in checkup.measures">
                                            <td><span ng-bind="measure.data.scheme_measure.measure.name"></span></td>
                                            <td>[[ measure.data.beg_datetime | asDateTime ]]</td>
                                            <td>[[ measure.data.end_datetime | asDateTime ]]</td>
                                            <td>
                                                <event-measure-status status="measure.data.status"></event-measure-status>
                                                <span ng-if="emIsNotActual(em)">(Неактуально)</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </tab>
            <tab heading="Данные плода">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">Общие данные</h3>
                                <a class="print_link pull-right" ng-if="!checkup.end_date"
                                   href="{{ url_for('.html_inspection_edit') }}?event_id=[[ header.event.id ]]&checkup_id=[[ checkup.id ]]#tab_fetus">
                                    <span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-sm-3 col-md-3  text-right">Дата первого шевеления:</div>
                                    <div class="col-sm-9 col-md-9">[[checkup.fetus_first_movement_date]]</div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-3 col-md-3  text-right">Шевеление:</div>
                                    <div class="col-sm-9 col-md-9">[[checkup.fetus_movement]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-class="{'active': $index==0}" class="tab-pane" id="fetus[[$index+1]]"
                         ng-repeat="child in checkup.fetuses | flt_not_deleted">
                        <div class="col-md-6">
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Плод [[$index+1]]</h3>
                                    <a class="print_link pull-right" ng-if="!checkup.end_date"
                                       href="{{ url_for('.html_inspection_edit') }}?event_id=[[ header.event.id ]]&checkup_id=[[ checkup.id ]]#tab_fetus">
                                        <span class="glyphicon glyphicon-pencil"></span> Изменить</a>
                                </div>
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Положение:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.position.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Позиция:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.position_2.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Вид плода:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.type.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Предлежание:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.presenting_part.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Задержка в развитии:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.delay.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Сердцебиение:</div>
                                        <div class="col-sm-6 col-md-6"><span ng-repeat="elem in checkup.heartbeat" >[[elem.name]][[$last ? '' : ', ']]</span></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">ЧСС, уд/мин:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.heart_rate]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right"><b>Данные КТГ:</b></div>
                                        <div class="col-sm-6 col-md-6">[[child.state.ktg_input ? 'да': 'нет']]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Базальный ритм:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.basal.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Вариабельность (амплитуда):</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.variability_range.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Вариабельность (частота в минуту):</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.frequency_per_minute.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Акселерации за 30 минут:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.acceleration.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-6 text-right">Децелерации за 30 минут:</div>
                                        <div class="col-sm-6 col-md-6">[[child.state.deceleration.name]]</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">&nbsp;</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </tab>
        </tabset>
    </section>
</div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script src="{{ url_for('.static', filename='js/checkup.js', v=app_version) }}"></script>
    <script src="{{ url_for('.static', filename='js/event_measure/event_measure_info.js', v=app_version) }}"></script>
    <script src="{{ url_for('.static', filename='js/event_measure/em_action_view.js', v=app_version) }}"></script>
{% endblock %}