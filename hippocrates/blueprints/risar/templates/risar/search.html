{% extends 'risar/base.html' %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
    <div ng-controller="EventSearchCtrl">
        <ul class="breadcrumb">
            <li><a href="{{ url_for('.index_html') }}">Рабочий стол</a></li>
            <li>Поиск карты пациентки</li>
        </ul>
        <div class="row">
            <form class="col-md-4">
{#                <div class="form-group">#}
{#                    <label>Страна</label>#}
{#                    <div class="form-control-static">-</div>#}
{#                </div>#}
{#                <div class="form-group">#}
{#                    <label>Регион</label>#}
{#                    <div class="form-control-static">-</div>#}
{#                </div>#}
{#                <div class="form-group">#}
{#                    <label>Район</label>#}
{#                    <div class="form-control-static">-</div>#}
{#                </div>#}
            <div class="panel panel-default">
            <div class="panel-heading">
                Фильтры
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label>Территория</label>
                    <ui-select multiple ng-model="query.areas" theme="select2" ng-change="refresh_organisations()" class="form-control">
                        <ui-select-match placeholder="Выберите территорию">[[ $item.name ]]</ui-select-match>
                        <ui-select-choices group-by="group_areas" repeat="area in areas | filter: {name: $select.search} | limitTo:50">
                            <div ng-bind-html="area.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
                <div class="form-group">
                    <label>ЛПУ</label>
                    <ui-select ng-model="query.org" theme="select2" ng-change="refresh_doctors()" class="form-control">
                        <ui-select-match>[[ $select.selected.short_name ]]</ui-select-match>
                        <ui-select-choices repeat="org in organisations | filter: {short_name: $select.search} | limitTo:50">
                            <div ng-bind-html="org.short_name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
                <div class="form-group">
                    <label>Врач</label>
                    <ui-select ng-model="query.person" theme="select2" class="form-control">
                        <ui-select-match>[[ $select.selected.name ]]</ui-select-match>
                        <ui-select-choices repeat="doc in doctors | filter: {full_name: $select.search} | limitTo:50">
                            <div ng-bind-html="doc.full_name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
                <div class="form-group">
                    <label>ФИО пациентки</label>
                    <input class="form-control" ng-model="query.fio">
                </div>
                <div class="form-group">
                    <label>Степень риска</label>
                    <div fs-checkbox="" items="risks_rb.objects" ng-model="query.risk" class="nopadding">
                        [[ item.name ]]
                    </div>
                </div>
                <div class="form-group">
                    <label>Дата родов</label>
                    <div class="row">
                        <div class="col-md-6">
                            <wm-date ng-model="query.bdate_from"></wm-date>
                        </div>
                        <div class="col-md-6">
                            <wm-date ng-model="query.bdate_to"></wm-date>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Дата осмотра</label>
                    <div class="row">
                        <div class="col-md-6">
                            <wm-date ng-model="query.checkup_date_from"></wm-date>
                        </div>
                        <div class="col-md-6">
                            <wm-date ng-model="query.checkup_date_to"></wm-date>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Статус карт</label>
                    <div fs-radio="" items="closed_items" ng-model="query.closed" class="nopadding">
                        [[ item.name ]]
                    </div>
                </div>
                <div class="pull-right">
                    <button type="button" class="btn btn-default" ng-click="reset_filters()">Очистить фильтры</button>
                </div>
            </div>
            </div>
            </form>
            <div class="col-md-8">
            <div class="panel panel-default">
            <div class="panel-heading">
                Результаты поиска карт пациенток: <b>[[pager.record_count]]</b>
            </div>
            <div class="panel-body">
                <table class="table table-condensed">
                    <thead>
                    <tr>
                        <th>Риск</th>
                        <th>№ карты</th>
                        <th>ФИО</th>
                        <th>Врач</th>
                        <th>Срок</th>
                        <th>Последнее<br>изменение</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="row in results">
                        <td risk-rate-icon="row.risk"></td>
                        <td>[[ row.external_id ]]</td>
                        <td><a ng-href="{{ url_for('.html_chart') }}?event_id=[[ row.event_id ]]">[[ row.name ]]</a></td>
                        <td>[[ row.exec_person_name ]]</td>
                        <td>[[ row.week ]]</td>
                        <td>[[ row.mdate | asDate ]]</td>
                    </tr>
                    </tbody>
                </table>
                <div>
                    <pagination ng-model="pager.current_page" total-items="pager.pages" items-per-page="1"
                        max-size="pager.max_pages" ng-change="onPageChanged()" ng-show="pager.pages > 1" boundary-links="true">
                    </pagination>
                </div>
            </div>
            </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script src="{{ url_for('.static', filename='js/search.js', v=version) }}"></script>
    <script src="{{ url_for('.static', filename='js/risar.js', v=version) }}"></script>
{% endblock %}