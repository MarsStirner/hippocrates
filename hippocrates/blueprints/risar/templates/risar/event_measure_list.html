{% extends 'risar/base.html' %}
{% import 'risar/_macros.html' as rimacros %}

{% block title %}> {{ module_name }}{% endblock %}

{% block main %}
    <div ng-controller="EventMeasureListCtrl" ng-cloak>
        <ul class="breadcrumb">
            <li><a href="{{ url_for('.index_html') }}">Рабочий стол</a></li>
            <li><a ng-href="{{ url_for('.html_chart') }}?event_id=[[ event_id ]]">Карта пациентки</a></li>
            <li>Мероприятия</li>
        </ul>
        {{ rimacros.page_title_n('Мероприятия случая') }}
        <div class="row">
            <form class="col-md-3">
            <div class="panel panel-default">
            <div class="panel-heading">
                Фильтры
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label>Тип мероприятия</label>
                    <div fs-checkbox="" items="rbMeasureType.objects" ng-model="query.measure_type" class="nopadding">
                        [[ item.name ]]
                    </div>
                </div>

                <div class="form-group">
                    <label>Дата начала</label>
                    <div class="row">
                        <div class="col-md-6">
                            <wm-date ng-model="query.beg_date_from"></wm-date>
                        </div>
                        <div class="col-md-6">
                            <wm-date ng-model="query.beg_date_to"></wm-date>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Дата окончания</label>
                    <div class="row">
                        <div class="col-md-6">
                            <wm-date ng-model="query.end_date_from"></wm-date>
                        </div>
                        <div class="col-md-6">
                            <wm-date ng-model="query.end_date_to"></wm-date>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Статус мероприятия</label>
                    <div fs-checkbox="" items="rbMeasureStatus.objects" ng-model="query.status" class="nopadding">
                        [[ item.name ]]
                    </div>
                </div>

                <div class="pull-right">
                    <button type="button" class="btn btn-default" ng-click="resetFilters()">Очистить фильтры</button>
                </div>
            </div>
            </div>
            </form>
            <div class="col-md-9">
            <div class="panel panel-default">
            <div class="panel-heading">
                Мероприятия: <b>[[pager.record_count]]</b>
            </div>
            <div class="panel-body">
                <table class="table table-condensed">
                    <thead>
                    <tr>
                        <th>Тип</th>
                        <th>Название</th>
                        <th>Статус</th>
                        <th>Дата начала</th>
                        <th>Дата окончания</th>
                        <th>Дата осмотра</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="em in measure_list">
                        <td><span measure-type-icon="em.scheme_measure.measure.measure_type" style="font-size: x-large"></span></td>
                        <td>[[ em.scheme_measure.measure.name ]]</td>
                        <td>[[ em.status.name ]]</td>
                        <td>[[ em.beg_datetime | asDate ]]</td>
                        <td>[[ em.end_datetime | asDate ]]</td>
                        <td><a ng-href="{{ url_for('.html_inspection_edit') +
                            '?event_id={0}&checkup_id={1}'.format('[[ em.event_id ]]', '[[ em.source_action.id ]]') }}"
                            title="Перейти к осмотру, на основе которого было создано мероприятие">
                            [[ em.source_action.beg_date | asDate ]]</a>
                        </td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
                <div>
                    <pagination ng-model="pager.current_page" total-items="pager.pages" items-per-page="1"
                        max-size="pager.max_pages" ng-change="onPageChanged()" ng-show="pager.pages > 1" boundary-links="true">
                    </pagination>
                </div>
            </div>
            </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block modules_js %}
    {{ super() }}
    <script src="{{ url_for('.static', filename='js/event_measure_list.js', v=version) }}"></script>
    <script src="{{ url_for('.static', filename='js/risar.js', v=version) }}"></script>
{% endblock %}