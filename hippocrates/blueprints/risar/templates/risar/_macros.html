{% macro page_title(title) %}
<h1>
    {{ title }}
    ([[ chart.external_id ]])
    <a ng-href="{{ url_for('patients.patient_info_full') }}?client_id=[[ chart.client.id ]]">[[ chart.client.full_name ]]</a>
</h1>
<div class="alert-warning vmargin10">Случай беременности. На учёте в <b>[[ chart.person.organisation.short_name ]]</b>
    у <b>[[ chart.person.name ]]</b>
    с <b>[[ chart.set_date | asDate ]]</b>
</div>
{% endmacro %}


{% macro page_title_n(title) %}
<h1>
    {{ title }}
    ([[ header.event.external_id ]])
    <a ng-href="{{ url_for('patients.patient_info_full') }}?client_id=[[ header.client.id ]]">[[ header.client.full_name ]]</a>
</h1>
<div class="row vmargin10">
    <div class="col-md-12 col-lg-12 col-sm-12">
        <div class="alert-warning">Случай беременности. На учёте в <b>[[ header.event.person.organisation.short_name ]]</b>
            у <b>[[ header.event.person.name ]]</b>
            с <b>[[ header.event.set_date | asDate ]]</b>
        </div>
    </div>
</div>
{% endmacro %}


{% macro page_title_ext(title, ext_header=None) %}
{%- if ext_header == 'chart' %}
    {% set w1 = 8 %} {% set w2 = 4 %}
{%  elif ext_header == 'inspection' %}
    {% set w1 = 10 %} {% set w2 = 2 %}
{% endif -%}
    <h1>
        {{ title }}
        ([[ header.event.external_id ]])
        <a ng-href="{{ url_for('patients.patient_info_full') }}?client_id=[[ header.client.id ]]">[[ header.client.full_name ]]</a>
    </h1>
    <div class="breadcrumb novpadding">
        {%- if ext_header == 'chart' %}
        <span class="pull-right">
            <i pregnancy-week-icon="chart.pregnancy_week" pregnancy-start-date="chart.card_attributes.pregnancy_start_date"></i>
            <i risk-rate-icon="chart.risk_rate"></i>
            <i card-fill-rate-icon="chart.card_fill_rates" event-id="header.event.id"></i>
        </span>
        <span>
{#            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" id="Layer_1" x="0px" y="0px" width="100px" height="70px" viewBox="-34.621 15 100 70" enable-background="new -34.621 15 100 70" xml:space="preserve">#}
{#            <path fill="skyblue" d="M50.531,46.758c0.229-1.679-0.312-3.451-1.606-4.745c-1.318-1.306-3.076-1.833-4.755-1.63  c-0.23,1.692,0.312,3.464,1.604,4.756C47.093,46.435,48.851,46.973,50.531,46.758"/>#}
{#            <path fill="skyblue" d="M49.982,46.758c-0.202-1.679,0.336-3.451,1.631-4.745c1.292-1.306,3.052-1.833,4.757-1.63  c0.204,1.692-0.337,3.464-1.63,4.756C53.447,46.435,51.688,46.973,49.982,46.758"/>#}
{#            <path fill="skyblue" d="M50.256,63.216c-8.98-0.3,0-15.627,0-15.627S59.237,63.503,50.256,63.216 M61.787,67.352  c0-12.929-11.53-21.628-11.53-21.628s-11.635,9.394-11.635,21.628c0,6.137,5.496,11.117,11.635,11.117S61.787,73.488,61.787,67.352"/>#}
{#            <path fill="silver" stroke="gray" d="M51.446,47.218l-0.282-0.462c0,0-8.154-0.461-11.171-0.69c-1.384-0.106-2.811-0.37-3.946-0.621  c-0.703-1.283-2.248-2.179-4.053-2.179c-1.057,0-2.014,0.318-2.779,0.828c-1.973,1.055-5.692,1.052-8.338,1.062  c-3.758,0.028-7.458-0.412-10.785-0.742c-5.744-0.585-8.17-3.033-4.818-6.607c19.652-20.932-32.086-22.769-37.173-16.965  c-3.113,3.688,36.113,4.81,23.64,19.229c-4.841,0.981-9.434,2.758-11.424,4.801c-1.67-0.784-3.696-1.381-5.566-0.965  c-1.874,2.118-1.542,4.995,0,6.145c1.765,0.377,3.69-0.116,5.319-0.799c2.117,3.083,8.237,5.649,14.896,5.649  c6.447,0,10.416-2.43,13.851-4.255c3.448-1.827,16.699-3.394,19.803-1.234c0.024,0.018,0.048,0.028,0.071,0.042  c0.817,0.752,1.988,1.234,3.302,1.234c1.657,0,3.086-0.761,3.856-1.876c1.385-0.259,3.186-0.579,4.052-0.655  C41.439,48.022,51.446,47.218,51.446,47.218z"/>#}
{#            </svg>#}
            <i class="ri-due-date"></i>
            <span ng-if="chart.epicrisis.delivery_date" tooltip="Фактическая дата родов">[[chart.epicrisis.delivery_date | asDate]]</span>
            <span ng-if="!chart.epicrisis.delivery_date" tooltip="Предполагаемая дата родов">[[chart.card_attributes.predicted_delivery_date | asDate]]</span>
            <i class="fa fa-question text-darkgray" tooltip="Предполагаемая дата родов" ng-if="!chart.epicrisis.delivery_date && !chart.card_attributes.predicted_delivery_date"></i>
        </span>
        {% elif ext_header == 'inspection' %}
        <div class="achievements">
        <a class="btn" href="{{ url_for('.html_inspection') }}?event_id=[[ header.event.id ]]"><i class="fa fa-table" tooltip="Осмотры акушером-гинекологом" style="width: 32px"></i></a>
        <a class="btn" href="{{ url_for('.html_gravidograma') }}?event_id=[[ header.event.id ]]"><i class="fa fa-line-chart" tooltip="Гравидограмма" style="width: 32px"></i></a>
        </div>
        {% endif -%}
    </div>
<div class="row tmargin10">
    <div class="col-md-12 col-lg-12 col-sm-12">
        <div class="alert-warning">Случай беременности. На учёте в <b>[[ header.event.person.organisation.short_name ]]</b>
            у <b>[[ header.event.person.name ]]</b>
            с <b>[[ header.event.set_date | asDate ]]</b>
        </div>
    </div>
</div>
{% endmacro %}

{% macro page_title_ext_n(title, ext_header=None) %}
{%- if ext_header == 'chart' %}
    {% set w1 = 8 %} {% set w2 = 4 %}
{%  elif ext_header == 'inspection' %}
    {% set w1 = 10 %} {% set w2 = 2 %}
{% endif -%}
<div class="row">
<div class="col-md-8 col-lg-8 col-sm-12">
<h1>
    {{ title }}
    ([[ header.event.external_id ]])
    <a ng-href="{{ url_for('patients.patient_info_full') }}?client_id=[[ header.client.id ]]">[[ header.client.full_name ]]</a>
</h1>
</div>
<div class="col-md-4 col-lg-4 col-sm-12">
{#    <div class="col-md-{{ w2 }} col-sm-12 achievements">#}
    <div class="achievements">
        {%- if ext_header == 'chart' %}
        <span class="pull-right" style="padding-right: 20px;">
            <i pregnancy-week-icon="chart.pregnancy_week" pregnancy-start-date="chart.card_attributes.pregnancy_start_date"></i>
            <i risk-rate-icon="chart.risk_rate"></i>
            <i preeclampsia-susp-icon="chart.preeclampsia_susp_rate"></i>
            <i preeclampsia-confirmed-icon="chart.preeclampsia_confirmed_rate"></i>
            <i card-fill-rate-icon="chart.card_fill_rates" event-id="header.event.id"></i>
        </span>
        <span>
{#            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" id="Layer_1" x="0px" y="0px" width="100px" height="70px" viewBox="-34.621 15 100 70" enable-background="new -34.621 15 100 70" xml:space="preserve">#}
{#            <path fill="skyblue" d="M50.531,46.758c0.229-1.679-0.312-3.451-1.606-4.745c-1.318-1.306-3.076-1.833-4.755-1.63  c-0.23,1.692,0.312,3.464,1.604,4.756C47.093,46.435,48.851,46.973,50.531,46.758"/>#}
{#            <path fill="skyblue" d="M49.982,46.758c-0.202-1.679,0.336-3.451,1.631-4.745c1.292-1.306,3.052-1.833,4.757-1.63  c0.204,1.692-0.337,3.464-1.63,4.756C53.447,46.435,51.688,46.973,49.982,46.758"/>#}
{#            <path fill="skyblue" d="M50.256,63.216c-8.98-0.3,0-15.627,0-15.627S59.237,63.503,50.256,63.216 M61.787,67.352  c0-12.929-11.53-21.628-11.53-21.628s-11.635,9.394-11.635,21.628c0,6.137,5.496,11.117,11.635,11.117S61.787,73.488,61.787,67.352"/>#}
{#            <path fill="silver" stroke="gray" d="M51.446,47.218l-0.282-0.462c0,0-8.154-0.461-11.171-0.69c-1.384-0.106-2.811-0.37-3.946-0.621  c-0.703-1.283-2.248-2.179-4.053-2.179c-1.057,0-2.014,0.318-2.779,0.828c-1.973,1.055-5.692,1.052-8.338,1.062  c-3.758,0.028-7.458-0.412-10.785-0.742c-5.744-0.585-8.17-3.033-4.818-6.607c19.652-20.932-32.086-22.769-37.173-16.965  c-3.113,3.688,36.113,4.81,23.64,19.229c-4.841,0.981-9.434,2.758-11.424,4.801c-1.67-0.784-3.696-1.381-5.566-0.965  c-1.874,2.118-1.542,4.995,0,6.145c1.765,0.377,3.69-0.116,5.319-0.799c2.117,3.083,8.237,5.649,14.896,5.649  c6.447,0,10.416-2.43,13.851-4.255c3.448-1.827,16.699-3.394,19.803-1.234c0.024,0.018,0.048,0.028,0.071,0.042  c0.817,0.752,1.988,1.234,3.302,1.234c1.657,0,3.086-0.761,3.856-1.876c1.385-0.259,3.186-0.579,4.052-0.655  C41.439,48.022,51.446,47.218,51.446,47.218z"/>#}
{#            </svg>#}
            <span class="nowrap">
                <i class="ri-due-date"></i>
                <span ng-if="chart.epicrisis.delivery_date" tooltip="Фактическая дата родов">[[chart.epicrisis.delivery_date | asDate]]</span>
                <span ng-if="!chart.epicrisis.delivery_date" tooltip="Предполагаемая дата родов">[[chart.card_attributes.predicted_delivery_date | asDate]]</span>
                <i class="fa fa-question text-darkgray" tooltip="Предполагаемая дата родов" ng-if="!chart.epicrisis.delivery_date && !chart.card_attributes.predicted_delivery_date"></i>
            </span>
        </span>
        {% elif ext_header == 'inspection' %}
        <div class="text-right" style="height: 34px;">
        <a class="btn-link text-center" href="{{ url_for('.html_inspection') }}?event_id=[[ header.event.id ]]"><i class="fa fa-table" tooltip="Осмотры акушером-гинекологом" style="width: 32px"></i></a>
        <a class="btn-link text-center" href="{{ url_for('.html_gravidograma') }}?event_id=[[ header.event.id ]]"><i class="fa fa-line-chart" tooltip="Гравидограмма" style="width: 32px"></i></a>
        </div>
        {% endif -%}
    </div>
</div>
</div>
<div class="row vmargin10">
    <div class="col-md-12 col-lg-12 col-sm-12">
        <div class="alert-warning">Случай беременности. На учёте в <b>[[ header.event.person.organisation.short_name ]]</b>
            у <b>[[ header.event.person.name ]]</b>
            с <b>[[ header.event.set_date | asDate ]]</b>
        </div>
    </div>
</div>
{% endmacro %}

{% macro navigation_btn_class_attribute(endpoints) %}
    {% if request.endpoint[5:] in endpoints %}class="btn btn-primary"{% else %}class="btn btn-default"{% endif %}
{% endmacro %}

{% macro navigation(event_id_repl, endpoints, ext_header=None) %}
<div class="novmargin">
    <div class="btn-group">
        <a ng-href="{{ url_for('.html_chart') }}?event_id={{ event_id_repl }}" {{ navigation_btn_class_attribute(['.html_chart']) }}>Карта пациентки</a>
        <a ng-href="{{ url_for('.html_anamnesis') }}?event_id={{ event_id_repl }}" {{ navigation_btn_class_attribute(['.html_anamnesis', '.html_anamnesis_father_edit', '.html_anamnesis_mother_edit']) }}>Анамнез</a>
        <div class="btn-group">
            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Осмотры <span class="fa fa-caret-down"></span></button>
            <ul role="menu" class="dropdown-menu">
                <li><a ng-href="{{ url_for('.html_inspection') }}?event_id={{ event_id_repl }}">Осмотры беременной</a></li>
                <li><a ng-href="{{ url_for('.html_inspection_puerpera') }}?event_id={{ event_id_repl }}">Осмотры родильницы</a></li>
                <li role="separator" class="divider"></li>
                <li><a ng-href="{{ url_for('.html_inspection_edit') }}?event_id={{ event_id_repl }}">Добавить осмотр акушером-гинекологом</a></li>
                <li><a ng-href="{{ url_for('.html_inspection_pc_edit') }}?event_id={{ event_id_repl }}">Добавить осмотр специалистом ПЦ</a></li>
                <li><a ng-href="{{ url_for('.html_inspection_puerpera_edit') }}?event_id={{ event_id_repl }}">Добавить осмотр родильницы</a></li>
            </ul>
        </div>
        <a ng-href="{{ url_for('.html_inspection_fetus') }}?event_id={{ event_id_repl }}" {{ navigation_btn_class_attribute(['.html_inspection_fetus']) }}>Плод</a>
        <a ng-href="{{ url_for('.html_concilium_list') }}?event_id={{ event_id_repl }}" {{ navigation_btn_class_attribute(['.html_concilium_list', '.html_concilium']) }}>Консилиумы</a>
        <div class="btn-group">
            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Риски <span class="fa fa-caret-down"></span></button>
            <ul role="menu" class="dropdown-menu">
                <li><a ng-href="{{ url_for('.html_risk_groups_list') }}?event_id={{ event_id_repl }}">Группы риска</a></li>
            </ul>
        </div>
        <a ng-href="{{ url_for('.html_routing') }}?event_id={{ event_id_repl }}&emergency=1" {{ navigation_btn_class_attribute(['.html_routing']) }}>Маршрутизация</a>
        <a ng-href="{{ url_for('.html_epicrisis') }}?event_id={{ event_id_repl }}" {{ navigation_btn_class_attribute(['.html_epicrisis', '.html_epicrisis_edit']) }}>Эпикриз</a>
        <a ng-class="{disabled: !ps.is_available()}" ng-click="open_print_window()" class="btn btn-default">Печать</a>
        <a ng-class="{hidden: '{{ ext_header }}' != 'chart'}" ng-click="create_errand()" class="btn btn-default">Создать поручение</a>
        <div class="btn-group">
            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Дополнительно <span class="fa fa-caret-down"></span></button>
            <ul role="menu" class="dropdown-menu">
                <li><a ng-href="{{ url_for('.html_event_diagnoses') }}?event_id={{ event_id_repl }}">Диагнозы случая</a></li>
                <li><a ng-href="{{ url_for('.html_event_measure') }}?event_id={{ event_id_repl }}">Мероприятия случая</a></li>
                <li><a ng-href="{{ url_for('.html_card_fill_history') }}?event_id={{ event_id_repl }}">Качество ведения карты</a></li>
            </ul>
        </div>
    </div>
</div>
{% endmacro %}